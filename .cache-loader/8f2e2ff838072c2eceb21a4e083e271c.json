{"remainingRequest":"/Users/zhangtengjin/Desktop/byai/topology/node_modules/thread-loader/dist/cjs.js??ref--6-oneOf-1-1!/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-loader/lib/index.js??ref--6-oneOf-1-2!/Users/zhangtengjin/Desktop/byai/topology/node_modules/eslint-loader/index.js??ref--5-0!/Users/zhangtengjin/Desktop/byai/topology/src/lib/components/topology/index.tsx","dependencies":[{"path":"/Users/zhangtengjin/Desktop/byai/topology/src/lib/components/topology/index.tsx","mtime":1647506177149},{"path":"/Users/zhangtengjin/Desktop/byai/topology/package.json","mtime":1647506605470},{"path":"/Users/zhangtengjin/Desktop/byai/topology/node_modules/cache-loader/dist/cjs.js","mtime":1645756501487},{"path":"/Users/zhangtengjin/Desktop/byai/topology/node_modules/thread-loader/dist/cjs.js","mtime":1645756504722},{"path":"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-loader/lib/index.js","mtime":1641784542889},{"path":"/Users/zhangtengjin/Desktop/byai/topology/node_modules/eslint-loader/index.js","mtime":1643179601592}],"contextDependencies":[],"result":["import _slicedToArray from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";import _classCallCheck from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/zhangtengjin/Desktop/byai/topology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import React from'react';import{renderToStaticMarkup}from'react-dom/server';import{DropTarget}from'react-dnd';import _ from'lodash';import classnames from'classnames';import selectNodes,{SelectMode}from'../../utils/selectNodes';import{Provider,defaultContext}from'../context';import NodeWrapper from'../node-wrapper';import Line from'../line';import{KeyCode,NodeTypes,ChangeType,LineEditType}from'../../declare';import{computeCanvasPo,impactCheck,computeAnchorPo,computeNodeInputPo,computeMouseClientToCanvas,computeContentCenter,computeContentPostionY,createHashFromObjectArray,getNodeSize,shouldAutoLayout,isMatchKeyValue}from'../../utils';// import layoutCalculation from '../../utils/layoutCalculation';\nimport computeLayout from'../../utils/computeLayout';import deleteSelectedData from'../../utils/deleteSelectedData';import config from'../../config';import'./index.less';var MAX_SCALE=2;var MIN_SCALE=0.1;var initialTopologyState={context:defaultContext,scaleNum:1,draggingId:null};var Topology=/*#__PURE__*/function(_React$Component){_inherits(Topology,_React$Component);var _super=_createSuper(Topology);function Topology(_props){var _this;_classCallCheck(this,Topology);_this=_super.call(this,_props);_this.$wrapper=void 0;_this.$canvas=void 0;_this.nodeSizeCache={};_this.state=initialTopologyState;_this.dragCanvasPo=null;_this.shouldAutoLayout=false;_this.onChange=function(data,type){var onChange=_this.props.onChange;if(!onChange){return;}onChange(data,type);};_this.scaleNum=1;_this.zoomIn=function(){_this.setState(function(prevState){var scaleNum=prevState.scaleNum>MIN_SCALE+0.1?prevState.scaleNum-0.1:MIN_SCALE;_this.scaleNum=scaleNum;return{scaleNum:scaleNum};});_this.setDraggingId(null);};_this.zoomOut=function(){_this.setState(function(prevState){var scaleNum=prevState.scaleNum<MAX_SCALE?prevState.scaleNum+0.1:MAX_SCALE;_this.scaleNum=scaleNum;return{scaleNum:scaleNum};});_this.setDraggingId(null);};_this.scrollCanvasToCenter=function(){if(!_this.$wrapper||!_this.$canvas){return;}var canvasSize=getNodeSize(_this.$canvas);var wrapperSize=getNodeSize(_this.$wrapper);var contentCenter=computeContentCenter(_this.props.data.nodes);var canvasCenter={x:canvasSize.width/2,y:canvasSize.height/2};var defaultScrollTop=(canvasSize.height-wrapperSize.height)/2;var defaultScrollLeft=(canvasSize.width-wrapperSize.width)/2;if(!contentCenter){_this.$wrapper.scrollTop=defaultScrollTop;_this.$wrapper.scrollLeft=defaultScrollLeft;}else{_this.$wrapper.scrollTop=defaultScrollTop+(contentCenter.y-canvasCenter.y);_this.$wrapper.scrollLeft=defaultScrollLeft+(contentCenter.x-canvasCenter.x);}};_this.scrollCanvasToPositionY=function(){if(!_this.$wrapper||!_this.$canvas){return;}var canvasSize=getNodeSize(_this.$canvas);var wrapperSize=getNodeSize(_this.$wrapper);var contentPosition=computeContentPostionY(_this.props.data.nodes);var canvasCenter={x:canvasSize.width/2,y:canvasSize.height/2};var defaultScrollTop=(canvasSize.height-wrapperSize.height)/2;var defaultScrollLeft=(canvasSize.width-wrapperSize.width)/2;if(!contentPosition){_this.$wrapper.scrollTop=defaultScrollTop;_this.$wrapper.scrollLeft=defaultScrollLeft;}else{_this.$wrapper.scrollTop=contentPosition.y-_this.props.customPostionHeight;_this.$wrapper.scrollLeft=defaultScrollLeft+(contentPosition.x-canvasCenter.x);}};_this.cacheNodeSize=function(){var nodes=_this.props.data.nodes;// 已节点id为键值，缓存节点的宽和高，避免碰撞检测时频繁操作DOM\n_this.nodeSizeCache=nodes.reduce(function(pre,cur){return _objectSpread({},pre,_defineProperty({},cur.id,getNodeSize(cur.id)));},{});};_this.impactCheck=function(endPo,startPo,id){var _this$props$data=_this.props.data,nodes=_this$props$data.nodes,lines=_this$props$data.lines;var impactNode=nodes.find(function(item){if(!_this.nodeSizeCache[item.id]){_this.nodeSizeCache[item.id]=getNodeSize(item.id);}return _this.nodeSizeCache[item.id]&&impactCheck(endPo,_this.nodeSizeCache[item.id],item.position);});// 起点和终点是同一节点\nif(impactNode&&impactCheck(startPo,_this.nodeSizeCache[impactNode.id],impactNode.position)){return null;}// 线已存在情况下\nvar hasExistSameLine=impactNode&&lines.find(function(item){return item.start===id&&item.end===impactNode.id;});if(hasExistSameLine)return null;// 节点不可被连接\nif(impactNode&&impactNode.canConnect===false)return null;return impactNode?impactNode.id:null;};_this.autoLayout=function(){var _this$props=_this.props,data=_this$props.data,sortChildren=_this$props.sortChildren;_this.onChange(_objectSpread({},data,{nodes:computeLayout(data,{sortChildren:sortChildren})}),ChangeType.LAYOUT);};_this.initDomEvents=function(){window.addEventListener(\"keydown\",_this.handleKeydown);};_this.removeDomEvents=function(){window.removeEventListener(\"keydown\",_this.handleKeydown);};_this.handleKeydown=function(e){// eslint-disable-next-line\nvar _ref=e.target,_ref$classList=_ref.classList,classList=_ref$classList===void 0?[]:_ref$classList;// 左侧的搜索输入框回删事件不触发话术更改\nif(classList[0]===\"ant-input\"){return;}switch(e.keyCode){case KeyCode.BACKSPACE:case KeyCode.DELETE:_this.deleteItem();break;default:break;}};_this.deleteItem=function(){var data=_this.props.data;var selectedData=_this.state.context.selectedData;_this.onChange(deleteSelectedData(data,selectedData),ChangeType.DELETE);};_this.setDraggingId=function(id){_this.setState({draggingId:id});};_this.setContext=function(values,callback){var context=_this.state.context;_this.setState({context:_objectSpread({},context,values)},function(){if(callback){callback();}});};_this.selectNode=function(node,mode){var _this$props2=_this.props,data=_this$props2.data,onSelect=_this$props2.onSelect;var selectedData=_this.state.context.selectedData;var selectNodesId=selectedData.nodes.map(function(item){return item.id;});if(mode===SelectMode.RIGHT_NORMAL&&selectNodesId.indexOf(node.id)!==-1){onSelect(selectedData);return;}_this.setContext({selectedData:selectNodes({data:data,selectedData:selectedData})({node:node,mode:mode})},function(){if(onSelect){onSelect(_this.state.context.selectedData);}});};_this.selectLine=function(data){_this.setContext({selectedData:data},function(){var onSelect=_this.props.onSelect;if(onSelect){onSelect(_this.state.context.selectedData);}});};_this.dragCanvas=function(clientX,clientY){if(!_this.$wrapper){return;}var dX=_this.dragCanvasPo.x-clientX;var dY=_this.dragCanvasPo.y-clientY;_this.dragCanvasPo={x:clientX,y:clientY};_this.$wrapper.scrollTop=_this.$wrapper.scrollTop+dY;_this.$wrapper.scrollLeft=_this.$wrapper.scrollLeft+dX;};_this.editLine=function(clientX,clientY){var activeLine=_this.state.context.activeLine;if(!_this.$wrapper||!activeLine){return;}var clientPo=computeMouseClientToCanvas(clientX,clientY,_this.$wrapper);var impactNode=_this.impactCheck(clientPo,activeLine[activeLine.type===LineEditType.EDIT_START?\"end\":\"start\"]);_this.setContext({impactNode:impactNode,activeLine:_objectSpread({},activeLine,_defineProperty({},activeLine.type,clientPo))});};_this.handleHoverCurrentNode=function(node){_this.setContext({hoverCurrentNode:node});};_this.clearHoverCurrentNode=function(){_this.setContext({hoverCurrentNode:null});};_this.handleMouseDown=function(e){// @ts-ignore\nvar itemType=e.target.getAttribute(\"data-type\");// @ts-ignore\nvar className=e.target.className;var getClickType=function getClickType(){// @ts-ignore\nif(// @ts-ignore\n[LineEditType.EDIT_START,LineEditType.EDIT_END].includes(itemType||\"\")){return\"CLICK_LINE_POINT\";}else if(typeof className===\"string\"&&className.includes(\"topology-canvas\")){return\"CLICK_CANVAS\";}return\"\";};switch(getClickType()){case\"CLICK_CANVAS\":_this.dragCanvasPo={x:e.clientX,y:e.clientY};break;case\"CLICK_LINE_POINT\":if(_this.props.readOnly){break;}try{// @ts-ignore\nvar jsonStr=e.target.getAttribute(\"data-json\");if(typeof jsonStr!==\"string\"||!jsonStr){throw new Error(\"线段起点无数据\");}var _JSON$parse=JSON.parse(jsonStr),origin=_JSON$parse.origin,po=_JSON$parse.po;_this.setContext({linking:true,activeLine:{origin:origin,start:po.start,end:po.end,type:itemType}});}catch(err){// eslint-disable-next-line no-console\nconsole.log(err);}break;default:break;}};_this.handleMouseMove=function(e){var activeLine=_this.state.context.activeLine;// @ts-ignore\nvar isEditingLine=activeLine// @ts-ignore\n&&[LineEditType.EDIT_START,LineEditType.EDIT_END].includes(activeLine.type);var isDraggingCanvas=_this.dragCanvasPo;if(!isEditingLine&&!isDraggingCanvas){return;}if(isDraggingCanvas){_this.dragCanvas(e.clientX,e.clientY);}if(isEditingLine&&!_this.props.readOnly){_this.editLine(e.clientX,e.clientY);}};_this.handleMouseUp=function(){var _this$props3=_this.props,lines=_this$props3.data.lines,readOnly=_this$props3.readOnly;var _this$state$context=_this.state.context,activeLine=_this$state$context.activeLine,impactNode=_this$state$context.impactNode;var isLineEdit=activeLine&&activeLine.type!==LineEditType.ADD;if(isLineEdit&&impactNode&&!readOnly){var _ref2=activeLine,_type=_ref2.type,origin=_ref2.origin;if(_type===LineEditType.EDIT_END){_this.onChange(_objectSpread({},_this.props.data,{lines:lines.map(function(item){return _.isEqual(item,origin)?_objectSpread({},item,{end:impactNode}):item;})}),ChangeType.EDIT_LINE);}}_this.clearMouseEventData();};_this.clearMouseEventData=function(){_this.dragCanvasPo=null;_this.setContext({activeLine:null,linking:false,impactNode:null});};_this.handleLineDraw=function(startId){var _this$props4=_this.props,data=_this$props4.data,_this$props4$lineColo=_this$props4.lineColor,lineColor=_this$props4$lineColo===void 0?{}:_this$props4$lineColo;var lines=_this.props.data.lines;var impactNode=_this.state.context.impactNode;if(impactNode){var newLine={start:startId,end:impactNode};var alreadyExist=lines.find(function(item){return _.isEqual(item,newLine);});var anchor=startId.split(\"-\")[1]||\"\";// eslint-disable-next-line\nconsole.log(\"anchor\",anchor);if(!alreadyExist){_this.onChange(_objectSpread({},data,{lines:[].concat(_toConsumableArray(data.lines),[_objectSpread({},newLine,{color:lineColor[anchor]})])}),ChangeType.ADD_LINE);}}_this.clearMouseEventData();};_this.handleNodeDraw=function(nodeId,position,childPosMap){var data=_this.props.data;var posMaps=_objectSpread(_defineProperty({},nodeId,position),childPosMap);_this.onChange(_objectSpread({},data,{// @ts-ignore\nnodes:data.nodes.map(function(item){return Object.keys(posMaps).includes(item.id)?_objectSpread({},item,{position:posMaps[item.id]}):item;})}),ChangeType.LAYOUT);};_this.handleCanvasClick=function(e){// @ts-ignore\nvar className=e.target.className;if(typeof className===\"string\"&&className.includes(\"topology-canvas\")){// 当按住cmd或者ctrl的时候，左键点击背景图层的时候，不会清楚选中的数据。\nif(e.ctrlKey||e.metaKey){return;}_this.setContext({selectedData:{nodes:[],lines:[]}},function(){var onSelect=_this.props.onSelect;if(onSelect){onSelect(_this.state.context.selectedData);}});}_this.setDraggingId(null);};_this.renderNodes=function(){var _this$props5=_this.props,_this$props5$data=_this$props5.data,nodes=_this$props5$data.nodes,lines=_this$props5$data.lines,renderTreeNode=_this$props5.renderTreeNode,readOnly=_this$props5.readOnly;var _this$state=_this.state,scaleNum=_this$state.scaleNum,draggingId=_this$state.draggingId;if(!renderTreeNode){return null;}var lineHash=lines.reduce(function(pre,cur){var _objectSpread5;var start=cur.start,end=cur.end;var _start$split=start.split(\"-\"),_start$split2=_slicedToArray(_start$split,1),parent=_start$split2[0];return _objectSpread({},pre,(_objectSpread5={},_defineProperty(_objectSpread5,parent,true),_defineProperty(_objectSpread5,end,true),_objectSpread5));},{});return nodes.map(function(item){return/*#__PURE__*/React.createElement(NodeWrapper,{onMouseEnter:_this.handleHoverCurrentNode,onMouseLeave:_this.clearHoverCurrentNode,key:item.id,id:\"\".concat(item.id),data:item,scaleNum:scaleNum,draggingId:draggingId,setDraggingId:_this.setDraggingId,readOnly:readOnly,isolated:!lineHash[item.id],onSelect:_this.selectNode},function(wrapperOptions){return(/* eslint-disable */renderTreeNode(item,wrapperOptions));});});};_this.renderDomMap=function(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.props;var nodes=props.data.nodes,renderTreeNode=props.renderTreeNode;if(!renderTreeNode){return;}var domMap=document.querySelector(\"#topology-dom-map\");if(!domMap){domMap=document.createElement(\"div\");domMap.setAttribute(\"id\",\"topology-dom-map\");}domMap.innerHTML=renderToStaticMarkup(/*#__PURE__*/React.createElement(\"div\",null,nodes.map(function(item){return/*#__PURE__*/React.createElement(\"div\",{key:item.id,id:\"dom-map-\".concat(item.id),className:\"dom-map-wrapper\"},renderTreeNode(item,{anchorDecorator:function anchorDecorator(_ref3){var anchorId=_ref3.anchorId;return function(_item){return/*#__PURE__*/React.createElement(\"div\",{id:\"dom-map-\".concat(item.id,\"-\").concat(anchorId),key:anchorId,className:\"dom-map-wrapper\"},_item);};}}));})));document.body.appendChild(domMap);setTimeout(_this.cacheNodeSize,1000);};_this.renderLines=function(){var _this$props6=_this.props,_this$props6$data=_this$props6.data,lines=_this$props6$data.lines,nodes=_this$props6$data.nodes,startPointAnchorId=_this$props6.startPointAnchorId,lineOffsetY=_this$props6.lineOffsetY,readOnly=_this$props6.readOnly,lineTextColor=_this$props6.lineTextColor;var _this$state$context2=_this.state.context,activeLine=_this$state$context2.activeLine,selectedData=_this$state$context2.selectedData,hoverCurrentNode=_this$state$context2.hoverCurrentNode;var nodeHash=createHashFromObjectArray(nodes,\"id\");var isEditing=function isEditing(line){return activeLine&&activeLine.origin&&_.isEqual(line,activeLine.origin);};var isSelected=function isSelected(line){return isEditing(line)||_.some(selectedData.lines,line);};// @ts-ignore\nvar isHighLight=function isHighLight(line){if(!hoverCurrentNode)return false;var id=hoverCurrentNode.id;if(line.start.split(\"-\")[0]===id||line.end===id)return true;};var getLineStartPo=function getLineStartPo(line){if(isEditing(line)&&activeLine.type===LineEditType.EDIT_START){return activeLine.start;}// 这里特殊处理下，目的是保持所有锚点的起始点位置与 startPointAnchorId 锚点位置一致\nreturn computeAnchorPo(// `dom-map-${line.start}`,\n\"dom-map-\".concat(startPointAnchorId===undefined?line.start:\"\".concat(line.start.split(\"-\")[0],\"-\").concat(startPointAnchorId)),nodeHash[line.start.split(\"-\")[0]]);};var getLineEndPo=function getLineEndPo(line){if(isEditing(line)&&activeLine.type===LineEditType.EDIT_END){return activeLine.end;}return computeNodeInputPo(nodeHash[line.end]);};return/*#__PURE__*/React.createElement(\"svg\",{className:\"topology-svg\"},lines.map(function(line,index){var start=getLineStartPo(line);var end=getLineEndPo(line);if(!start||!end){return null;}var key=\"\".concat(line.start,\"-\").concat(line.end);var anchorId=line.start.split(\"-\")[1];var getTextXY=function getTextXY(){var minX=Math.min(start.x,end.x);var minY=Math.min(start.y,end.y);var x=minX+Math.abs((start.x-end.x)/2);var y=minY+Math.abs((start.y-end.y)/2);return{x:x,y:y};};return/*#__PURE__*/React.createElement(React.Fragment,null,lineTextColor&&/*#__PURE__*/React.createElement(\"text\",{x:getTextXY().x,y:getTextXY().y,key:index,style:{fill:lineTextColor[anchorId]}},anchorId===startPointAnchorId?null:anchorId),/*#__PURE__*/React.createElement(Line,{key:key,lineOffsetY:lineOffsetY,data:line,start:start,end:end,onSelect:_this.selectLine,selected:isSelected(line),highLight:isHighLight(line),readOnly:readOnly}));}),activeLine&&activeLine.type===LineEditType.ADD&&/*#__PURE__*/React.createElement(Line,activeLine));};_this.renderToolBars=function(){var scaleNum=_this.state.scaleNum;/* eslint-disable */ // @ts-ignore\nvar zoomPercent=\"\".concat(parseInt(String(scaleNum.toFixed(1)*100)),\"%\");return/*#__PURE__*/React.createElement(\"div\",{className:\"topology-tools\"},/*#__PURE__*/React.createElement(\"div\",{className:\"topology-tools-btn\",id:\"scroll-canvas-to-center\",onClick:_this.scrollCanvasToCenter},/*#__PURE__*/React.createElement(\"img\",{src:\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTYwMzI3NjY4NDk5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjExMzciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEzLjc5OTY0OSAyOTUuNzQyMjM4Yy0xMTguMTc2OTE5IDAtMjE0LjE1ODE3MiA5Ni4xODEyMTUtMjE0LjE1ODE3MyAyMTQuMTU4MTcyIDAgMTE4LjE3NjkxOSA5Ni4xODEyMTUgMjE0LjE1ODE3MiAyMTQuMTU4MTczIDIxNC4xNTgxNzIgMTE3Ljk3Njk1OCAwIDIxNC4xNTgxNzItOTUuNzgxMjkzIDIxNC4xNTgxNzItMjEzLjk1ODIxMXMtOTYuMTgxMjE1LTIxNC4zNTgxMzMtMjE0LjE1ODE3Mi0yMTQuMzU4MTMzeiBtMCAzNjcuMzI4MjU2Yy04NC4zODM1MTkgMC0xNTIuOTcwMTIzLTY4LjU4NjYwNC0xNTIuOTcwMTI0LTE1Mi45NzAxMjNzNjguNTg2NjA0LTE1Mi45NzAxMjMgMTUyLjk3MDEyNC0xNTIuOTcwMTIzIDE1Mi45NzAxMjMgNjguNTg2NjA0IDE1Mi45NzAxMjMgMTUyLjk3MDEyMy02OC41ODY2MDQgMTUyLjk3MDEyMy0xNTIuOTcwMTIzIDE1Mi45NzAxMjN6IiBmaWxsPSIjMzMzMzMzIiBwLWlkPSIxMTM4Ij48L3BhdGg+PHBhdGggZD0iTTk5MS4zMDYzODUgNDgwLjUwNjE1MUg5MTMuOTIxNWMtNy4xOTg1OTQtOTYuNTgxMTM2LTQ4LjE5MDU4OC0xODYuMzYzNjAxLTExNy4zNzcwNzUtMjU1LjU1MDA4OHMtMTU4Ljk2ODk1MS0xMTAuMTc4NDgxLTI1NS41NTAwODgtMTE3LjM3NzA3NVYzMC41OTQwMjVjMC0xNi43OTY3MTktMTMuNzk3MzA1LTMwLjU5NDAyNS0zMC41OTQwMjUtMzAuNTk0MDI1cy0zMC41OTQwMjUgMTMuNzk3MzA1LTMwLjU5NDAyNCAzMC41OTQwMjV2NzYuOTg0OTYzYy05Ni4zODExNzYgNy4xOTg1OTQtMTg2LjM2MzYwMSA0OC4xOTA1ODgtMjU1LjU1MDA4OCAxMTcuMzc3MDc1UzExNC4wNzc3MTkgMzgzLjcyNTA1NCAxMDYuODc5MTI1IDQ4MC41MDYxNTFIMzAuNjk0MDA1Yy0xNi43OTY3MTkgMC0zMC41OTQwMjUgMTMuNzk3MzA1LTMwLjU5NDAyNSAzMC41OTQwMjVzMTMuNzk3MzA1IDMwLjU5NDAyNSAzMC41OTQwMjUgMzAuNTk0MDI0aDc2LjE4NTEyYzcuMTk4NTk0IDk2LjU4MTEzNiA0OC4xOTA1ODggMTg2LjM2MzYwMSAxMTcuMzc3MDc1IDI1NS41NTAwODhzMTU4Ljk2ODk1MSAxMTAuMTc4NDgxIDI1NS41NTAwODggMTE3LjM3NzA3NXY3OC43ODQ2MTJjMCAxNi43OTY3MTkgMTMuNzk3MzA1IDMwLjU5NDAyNSAzMC41OTQwMjQgMzAuNTk0MDI1czMwLjU5NDAyNS0xMy43OTczMDUgMzAuNTk0MDI1LTMwLjU5NDAyNXYtNzguNzg0NjEyYzk2LjM4MTE3Ni03LjE5ODU5NCAxODYuMzYzNjAxLTQ4LjE5MDU4OCAyNTUuNTUwMDg4LTExNy4zNzcwNzVzMTEwLjE3ODQ4MS0xNTguOTY4OTUxIDExNy4zNzcwNzUtMjU1LjU1MDA4OGg3Ny4zODQ4ODVjMTYuNzk2NzE5IDAgMzAuNTk0MDI1LTEzLjc5NzMwNSAzMC41OTQwMjUtMzAuNTk0MDI0IDAtMTYuOTk2NjgtMTMuNzk3MzA1LTMwLjU5NDAyNS0zMC41OTQwMjUtMzAuNTk0MDI1ek03NTMuMTUyOSA3NTMuODUyNzYzYy02NC43ODczNDYgNjQuNzg3MzQ2LTE1MS4xNzA0NzUgMTAwLjU4MDM1NS0yNDIuNzUyNTg4IDEwMC41ODAzNTYtOTEuNzgyMDc0IDAtMTc3Ljk2NTI0MS0zNS43OTMwMDktMjQyLjc1MjU4Ny0xMDAuNTgwMzU2LTY0Ljc4NzM0Ni02NC43ODczNDYtMTAwLjU4MDM1NS0xNTEuMTcwNDc1LTEwMC41ODAzNTUtMjQyLjc1MjU4N3MzNS43OTMwMDktMTc3Ljk2NTI0MSAxMDAuNTgwMzU1LTI0Mi43NTI1ODhjNjQuNzg3MzQ2LTY0Ljc4NzM0NiAxNTEuMTcwNDc1LTEwMC41ODAzNTUgMjQyLjc1MjU4Ny0xMDAuNTgwMzU1IDkxLjc4MjA3NCAwIDE3Ny45NjUyNDEgMzUuNzkzMDA5IDI0Mi43NTI1ODggMTAwLjU4MDM1NSA2NC43ODczNDYgNjQuNzg3MzQ2IDEwMC41ODAzNTUgMTUxLjE3MDQ3NSAxMDAuNTgwMzU1IDI0Mi43NTI1ODhzLTM1LjU5MzA0OCAxNzcuOTY1MjQxLTEwMC41ODAzNTUgMjQyLjc1MjU4N3oiIGZpbGw9IiMzMzMzMzMiIHAtaWQ9IjExMzkiPjwvcGF0aD48L3N2Zz4=\",alt:\"\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"tooltip\"},\"\\u5B9A\\u4F4D\\u4E2D\\u5FC3\")),/*#__PURE__*/React.createElement(\"div\",{className:\"topology-tools-btn\",id:\"auto-layout\",onClick:_this.autoLayout},/*#__PURE__*/React.createElement(\"img\",{src:\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTYwMzI3NjU0MDc4IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwMjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNODg1LjkyNzYxNyA2NzQuMzAwMTMyVjQ5Ny42NDYxMTNINTQwLjc3MTIyVjM1My44Mjk5MjRoMzQ1LjE1NzQyMVYxMjMuNjk3MDA2SDEzOC4wNzAzMzZ2MjMwLjEzMjkxOGgzNDUuMTU3NDIxdjE0My44MTYxODlIMTM4LjA3MDMzNnYxNzYuNjU0MDE5Yy00OS40Nzc3NzkgMTIuODYyOTMzLTg2LjI4ODA3NiA1Ny40OTc0MTQtODYuMjg4MDc2IDExMC45NTA3MjkgMCA2My40NTMwNDQgNTEuNTk4MDY1IDExNS4wNTIxMzMgMTE1LjA1NDE3OSAxMTUuMDUyMTMzIDYzLjQ1MjAyMSAwIDExNS4wNTAwODYtNTEuNTk5MDg5IDExNS4wNTAwODYtMTE1LjA1MjEzMyAwLTUzLjQ1MzMxNi0zNi44MTAyOTctOTguMDg3Nzk2LTg2LjI4ODA3Ni0xMTAuOTUwNzI5VjU1NS4xNDQ1NWgyODcuNjMwMzMxdjExOS4xNTQ1NTljLTQ5LjQ5MTA4MiAxMi44NjI5MzMtODYuMjg4MDc2IDU3LjQ5NzQxNC04Ni4yODgwNzYgMTEwLjk1MDcyOSAwIDYzLjQ1MzA0NCA1MS41OTkwODkgMTE1LjA1MjEzMyAxMTUuMDY2NDU5IDExNS4wNTIxMzMgNjMuNDI1NDE1IDAgMTE1LjA1NDE3OS01MS41OTkwODkgMTE1LjA1NDE3OS0xMTUuMDUyMTMzIDAtNTMuNDUzMzE2LTM2Ljc5ODAxNy05OC4wODc3OTYtODYuMjg5MDk5LTExMC45NTA3MjlWNTU1LjE0NDU1aDI4Ny42MzAzMzF2MTE5LjE1NDU1OWMtNDkuNDkzMTI5IDEyLjg2MjkzMy04Ni4yODcwNTMgNTcuNDk3NDE0LTg2LjI4NzA1MyAxMTAuOTUwNzI5IDAgNjMuNDUzMDQ0IDUxLjU2OTQxMyAxMTUuMDUyMTMzIDExNS4wNTExMSAxMTUuMDUyMTMzIDYzLjQyNDM5MSAwIDExNS4wNTMxNTYtNTEuNTk5MDg5IDExNS4wNTMxNTYtMTE1LjA1MjEzMy0wLjAwMjA0Ny01My40NTMzMTYtMzYuODAwMDY0LTk4LjA4Njc3My04Ni4yOTIxNy0xMTAuOTQ5NzA2ek0xOTUuNTk3NDI2IDE4MS4yMjQwOTZoNjMyLjgwNDEyNXYxMTUuMDUyMTMySDE5NS41OTc0MjZWMTgxLjIyNDA5NnogbTI4Ljc2NDA1NiA2MDQuMDI2NzY1YzAgMzEuNzEyMTk2LTI1LjgxNDg5NCA1Ny41NTQ3MTktNTcuNTI2MDY2IDU3LjU1NDcxOS0zMS43MTQyNDIgMC01Ny41MjcwOS0yNS44NDI1MjMtNTcuNTI3MDktNTcuNTU0NzE5IDAtMzEuNzE0MjQyIDI1LjgxMjg0Ny01Ny40OTg0MzcgNTcuNTI3MDktNTcuNDk4NDM3IDMxLjcxMjE5Ni0wLjAwMTAyMyA1Ny41MjYwNjYgMjUuNzgzMTcxIDU3LjUyNjA2NiA1Ny40OTg0Mzd6IG0zNDUuMTcxNzQ3IDBjMCAzMS43MTIxOTYtMjUuODQxNSA1Ny41NTQ3MTktNTcuNTI3MDg5IDU3LjU1NDcxOS0zMS43MjQ0NzUgMC01Ny41MzkzNjktMjUuODQyNTIzLTU3LjUzOTM2OS01Ny41NTQ3MTkgMC0zMS43MTQyNDIgMjUuODE1OTE3LTU3LjQ5ODQzNyA1Ny41MzkzNjktNTcuNDk4NDM3IDMxLjY4NTU5LTAuMDAxMDIzIDU3LjUyNzA5IDI1Ljc4MzE3MSA1Ny41MjcwODkgNTcuNDk4NDM3eiBtMjg3LjYzMTM1NSA1Ny41NTQ3MTljLTMxLjc0MTg3MiAwLTU3LjUyODExMy0yNS44NDI1MjMtNTcuNTI4MTEzLTU3LjU1NDcxOSAwLTMxLjcxNDI0MiAyNS43ODYyNDEtNTcuNDk4NDM3IDU3LjUyODExMy01Ny40OTg0MzcgMzEuNjg1NTkgMCA1Ny41MjcwOSAyNS43ODQxOTUgNTcuNTI3MDkgNTcuNDk4NDM3IDAgMzEuNzEyMTk2LTI1Ljg0MTUgNTcuNTU0NzE5LTU3LjUyNzA5IDU3LjU1NDcxOXoiIGZpbGw9IiMyYzJjMmMiIHAtaWQ9IjEwMjMiPjwvcGF0aD48L3N2Zz4=\",alt:\"\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"tooltip\"},\"\\u81EA\\u52A8\\u5E03\\u5C40\")),/*#__PURE__*/React.createElement(\"div\",{className:\"topology-tools-zoom\",onClick:_this.zoomIn},/*#__PURE__*/React.createElement(\"img\",{src:\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIxOTIzNzE5OTI0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwOTIwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjEyOCIgaGVpZ2h0PSIxMjgiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMi42MTY5NDIgNjQuMTg2NjczYzYxLjcyMDU1MyAwIDExOS43OTA3ODIgMTEuNzc5ODEzIDE3NC4yMTEwODUgMzUuMzM5NDRzMTAxLjcwNjA0MyA1NS40MTU0MjggMTQxLjg1NzQyMSA5NS41Njc0MDVjNDAuMTUxMzc3IDQwLjE1MTk3NyA3Mi4wMDcxNzkgODcuMjcxODMgOTUuNTY3NDA1IDE0MS4zNTk3NTggMjMuNTYwMjI2IDU0LjA4NzcyOSAzNS4zNDAwMzkgMTExLjk5MjI2OSAzNS4zMzk0NCAxNzMuNzEzNDIyLTAuMDAwNiA2MS43MjA5NTMtMTEuNzgwMjEzIDExOS43OTEzODEtMzUuMzM5NDQgMTc0LjIxMTA4NS0yMy41NTkwMjcgNTQuNDE5NzAzLTU1LjQxNTAyOSAxMDEuNzA1NDQ0LTk1LjU2NzQwNSAxNDEuODU3NDIxLTQwLjE1MjU3NyA0MC4xNTE5NzctODcuNDM4MzE3IDcyLjAwNzc3OS0xNDEuODU3NDIxIDk1LjU2NzQwNS01NC40MTkxMDQgMjMuNTU5NjI3LTExMi40ODkzMzIgMzUuMzM5NDQtMTc0LjIxMTA4NSAzNS4zMzk0NHMtMTE5LjYyNjA5NC0xMS43Nzk4MTMtMTczLjcxMzQyMi0zNS4zMzk0NGMtNTQuMDg3MzI5LTIzLjU1OTYyNy0xMDEuMjA3MTgyLTU1LjQxNTQyOC0xNDEuMzU5NzU4LTk1LjU2NzQwNS00MC4xNTI1NzctNDAuMTUxOTc3LTcyLjAwODM3OC04Ny40Mzc3MTctOTUuNTY3NDA1LTE0MS44NTc0MjFzLTM1LjMzODg0LTExMi40ODk5MzItMzUuMzM5NDQtMTc0LjIxMTA4NWMtMC4wMDA2LTYxLjcyMTE1MyAxMS43NzkyMTQtMTE5LjYyNTQ5NCAzNS4zMzk0NC0xNzMuNzEzNDIyczU1LjQxNjAyOC0xMDEuMjA3NzgxIDk1LjU2NzQwNS0xNDEuMzU5NzU4IDg3LjI3MTIzLTcyLjAwNzc3OSAxNDEuMzU5NzU4LTk1LjU2NzQwNVM0NTAuODk2NTg4IDY0LjE4Njg3MyA1MTIuNjE2OTQyIDY0LjE4NjY3M3pNNzM0LjYxMDgzIDU3MC44OTEzMjhjMTkuOTA5NzAxIDAgMzcuODI4NTUyLTUuMTQzMzEzIDUzLjc1NjE1My0xNS40Mjk5MzkgMTUuOTI3NjAxLTEwLjI4NjYyNiAyMy44OTE0MDItMjUuNzE2NTY0IDIzLjg5MTQwMi00Ni4yODk4MTYgMC0xOS45MDk3MDEtNy45NjM4MDEtMzQuNjc2Mjg5LTIzLjg5MTQwMi00NC4yOTkzNjUtMTUuOTI3NjAxLTkuNjIzMDc2LTMzLjg0NjI1Mi0xNC40MzQ2MTMtNTMuNzU2MTUzLTE0LjQzNDgxM0wyOTQuNjA0MTU0IDQ1MC40MzczOTVjLTE5LjkwOTcwMSAwLTM4LjE2MDUyNyA0LjgxMTUzOC01NC43NTIyNzggMTQuNDM0ODEzLTE2LjU5MTc1MSA5LjYyMzA3Ni0yNC44ODc1MjYgMjQuMzg5NjY0LTI0Ljg4NzUyNiA0NC4yOTkzNjUgMCAyMC41NzMyNTEgOC4yOTU3NzUgMzYuMDAzMTkgMjQuODg3NTI2IDQ2LjI4OTgxNiAxNi41OTE3NTEgMTAuMjg2NjI2IDM0Ljg0MjM3NyAxNS40Mjk5MzkgNTQuNzUyMjc4IDE1LjQyOTkzOUw3MzQuNjEwODMgNTcwLjg5MTMyOCA3MzQuNjEwODMgNTcwLjg5MTMyOHoiIHAtaWQ9IjEwOTIxIiBmaWxsPSIjOUZBMkE4Ij48L3BhdGg+PC9zdmc+\",alt:\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"topology-tools-percent\"},zoomPercent),/*#__PURE__*/React.createElement(\"div\",{className:\"topology-tools-zoom\",onClick:_this.zoomOut},/*#__PURE__*/React.createElement(\"img\",{src:\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIxOTIzNDA4MzQyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjgwNSIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC43NzgxMDY5LjAuaTIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTE3LjEyIDQzLjkxOTM2Yy0yNTguNzM0MDggMC00NjguNDggMjA5Ljc0NTkyLTQ2OC40OCA0NjguNDhzMjA5Ljc0NTkyIDQ2OC40OCA0NjguNDggNDY4LjQ4IDQ2OC40OC0yMDkuNzQ1OTIgNDY4LjQ4LTQ2OC40OC0yMDkuNzQ1OTItNDY4LjQ4LTQ2OC40OC00NjguNDh6TTc0Mi4yMzg3MiA1NjUuNzZINTcwLjg4djE3MS43OTkwNGMwIDI5LjU2OC0yNC4xOTIgNTMuNzYtNTMuNzYgNTMuNzZzLTUzLjc2LTI0LjE5Mi01My43Ni01My43NlY1NjUuNzZoLTE3MS40MzgwOGMtMjkuNTY4IDAtNTMuNzYtMjQuMTkyLTUzLjc2LTUzLjc2czI0LjE5Mi01My43NiA1My43Ni01My43Nkg0NjMuMzZ2LTE3MC45OTc3NmMwLTI5LjU2OCAyNC4xOTItNTMuNzYgNTMuNzYtNTMuNzZzNTMuNzYgMjQuMTkyIDUzLjc2IDUzLjc2VjQ1OC4yNGgxNzEuMzU4NzJjMjkuNTY4IDAgNTMuNzYgMjQuMTkyIDUzLjc2IDUzLjc2cy0yNC4xOTIgNTMuNzYtNTMuNzYgNTMuNzZ6IiBwLWlkPSI4MDYiIGZpbGw9IiM5RkEyQTgiPjwvcGF0aD48L3N2Zz4=\",alt:\"\"})));};_this.handleSelectAll=function(){var _this$props7=_this.props,data=_this$props7.data,onSelect=_this$props7.onSelect;_this.setContext({selectedData:data},function(){if(onSelect){onSelect(_this.state.context.selectedData);}});};_this.validateIsOverlap=function(drawId,pos){var _this$props8=_this.props,nodes=_this$props8.data.nodes,overlap=_this$props8.overlap,_this$props8$overlapO=_this$props8.overlapOffset,overlapOffset=_this$props8$overlapO===void 0?{}:_this$props8$overlapO;if(!overlap)return false;var getNodeOffsetPos=function getNodeOffsetPos(position,id){return{x:position.x+getNodeSize(id).width+overlapOffset.offsetX||0,y:position.y+getNodeSize(id).height+overlapOffset.offsetY||0};};var S1={x:pos.x,y:pos.y};var S2=getNodeOffsetPos(pos,drawId);var posMap=nodes&&nodes.filter(function(n){return n.id!==drawId&&!n.filterOverlap;}).map(function(n){return{T1:{x:n.position.x,y:n.position.y},T2:getNodeOffsetPos(n.position,n.id)};});var isOverlap=posMap.some(function(p){return!(S2.y<p.T1.y||S1.y>p.T2.y||S2.x<p.T1.x||S1.x>p.T2.x)===true;});return isOverlap;};_this.shouldAutoLayout=shouldAutoLayout(_props.data.nodes);return _this;}_createClass(Topology,[{key:\"componentWillMount\",value:function componentWillMount(){this.renderDomMap();}},{key:\"componentDidMount\",value:function componentDidMount(){var _this$props9=this.props,getInstance=_this$props9.getInstance,readOnly=_this$props9.readOnly,customPostionHeight=_this$props9.customPostionHeight;this.editLine=_.throttle(this.editLine,40);if(!readOnly){this.initDomEvents();}if(this.$wrapper){// 自定义节点距离画布顶部高度\nif(customPostionHeight){this.scrollCanvasToPositionY();}else{this.scrollCanvasToCenter();}}if(this.shouldAutoLayout){this.shouldAutoLayout=false;this.autoLayout();}if(getInstance){getInstance(this);}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(nextProps){var readOnly=this.props.readOnly;var nextReadOnly=nextProps.readOnly;this.renderDomMap(nextProps);this.shouldAutoLayout=shouldAutoLayout(nextProps.data.nodes);if(readOnly&&!nextReadOnly){this.initDomEvents();}if(!readOnly&&nextReadOnly){this.removeDomEvents();}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){if(this.shouldAutoLayout){this.shouldAutoLayout=false;this.autoLayout();}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){// @ts-ignore\nif(typeof this.editLine.cancel===\"function\"){// @ts-ignore\nthis.editLine.cancel();}this.removeDomEvents();}},{key:\"render\",value:function render(){var _this2=this;var _this$props10=this.props,connectDropTarget=_this$props10.connectDropTarget,showBar=_this$props10.showBar;var _this$state2=this.state,context=_this$state2.context,scaleNum=_this$state2.scaleNum;return connectDropTarget(/*#__PURE__*/React.createElement(\"div\",{className:\"byai-topology\"},/*#__PURE__*/React.createElement(\"div\",{ref:function ref(r){_this2.$wrapper=r;},className:classnames({\"topology-wrapper\":true,\"topology-linking\":context.linking}),onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,onMouseLeave:this.clearMouseEventData},/*#__PURE__*/React.createElement(\"div\",{ref:function ref(r){_this2.$canvas=r;},className:\"topology-canvas topology-zoom\"// @ts-ignore\n,style:{width:config.canvas.width,height:config.canvas.height,// @ts-ignore\n\"--scaleNum\":scaleNum},onClick:this.handleCanvasClick},/*#__PURE__*/React.createElement(Provider,{value:context},this.renderNodes(),this.renderLines()))),showBar!==false&&this.renderToolBars()));}}]);return Topology;}(React.Component);function hover(props,monitor,component){if(!monitor.getItem()){return;}var context=component.state.context;var clientOffset=monitor.getClientOffset();var _monitor$getItem=monitor.getItem(),id=_monitor$getItem.id,type=_monitor$getItem.type;switch(type){case NodeTypes.ANCHOR:if(clientOffset){var nodeId=id.split('-')[0];var parentNode=props.data.nodes.find(function(item){return item.id===nodeId;});var hasAnchorExistLine=!props.canConnectMultiLines&&props.data.lines.find(function(item){return item.start===id;});if(hasAnchorExistLine||!parentNode||!component.$wrapper){return;}var startPo=context.activeLine?context.activeLine.start:computeAnchorPo(\"dom-map-\".concat(id),parentNode);var endPo=computeCanvasPo(clientOffset,component.$wrapper);if(!startPo||!endPo){return;}var impactNode=component.impactCheck(endPo,startPo,id);component.setContext({impactNode:impactNode,linking:true,activeLine:{type:LineEditType.ADD,origin:null,start:startPo,end:endPo}});}break;default:break;}}export default DropTarget([NodeTypes.NORMAL_NODE,NodeTypes.TEMPLATE_NODE,NodeTypes.ANCHOR],{canDrop:function canDrop(props){return!props.readOnly;},hover:_.throttle(hover,40),drop:function drop(props,monitor,component){if(monitor.didDrop()||!component.$wrapper){return;}var item=monitor.getItem();var type=monitor.getItemType();var clientOffset=monitor.getDifferenceFromInitialOffset();if(!clientOffset){return;}var getNodePosition=function getNodePosition(nodeDom,isChild){var nodePosition={top:nodeDom.style.top,left:nodeDom.style.left};var scalePosition={x:Number(nodePosition.left.replace(/[px]+/g,\"\"))+clientOffset.x/component.scaleNum,y:Number(nodePosition.top.replace(/[px]+/g,\"\"))+clientOffset.y/component.scaleNum};var scrollPosition=computeCanvasPo(monitor.getSourceClientOffset(),component.$wrapper);/**\n                 * TODO： scaleNum 缩放与窗口滚动时有冲突, isChild 为子节点联动时使用 scalePosition 定位\n                 */var position=component.scaleNum===1?isChild?scalePosition:scrollPosition:scalePosition;return position;};/**\n             * Get the mapping relationship between the id and position of all child nodes of the current dragging node\n             * @returns\n             */var getChildPosMap=function getChildPosMap(){var _props$data=props.data,lines=_props$data.lines,nodes=_props$data.nodes;var curNode=nodes.find(function(n){return n.id===item.id;});var dragChild=curNode.dragChild||isMatchKeyValue(curNode,'dragChild',true);if(!dragChild)return null;var childIds=lines.filter(function(n){return n.start.split('-')[0]===item.id;}).map(function(n){return n.end;});var childPosMap={};var _iterator=_createForOfIteratorHelper(childIds),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var childId=_step.value;var childNodeDom=document.getElementById(\"topology-node-\".concat(childId));if(!childNodeDom)return null;childPosMap[childId]=getNodePosition(childNodeDom,true);}}catch(err){_iterator.e(err);}finally{_iterator.f();}return childPosMap;};var position;var nodeDom=document.getElementById(\"topology-node-\".concat(item.id));if(nodeDom){position=getNodePosition(nodeDom);}else{position=computeCanvasPo(monitor.getSourceClientOffset(),component.$wrapper);}var isOverlap=function isOverlap(id,position){return component.validateIsOverlap(id,position);};switch(type){case NodeTypes.TEMPLATE_NODE:if(!item.data){return;}/**\n                     * TODO：Here first render the newly added node, if it overlaps, delete the node\n                     * The main reason is that there is currently no good unified method to get the default width and height of the newly added nodes in the upper layer.\n                     */component.onChange(_objectSpread({},props.data,{nodes:[].concat(_toConsumableArray(props.data.nodes),[_objectSpread({},item.data,{position:position})])}),ChangeType.ADD_NODE);if(isOverlap(item.data.id,position)){component.onChange(_objectSpread({},props.data,{nodes:_toConsumableArray(props.data.nodes)}),ChangeType.ADD_NODE);props.overlapCallback&&props.overlapCallback();};break;case NodeTypes.NORMAL_NODE:if(isOverlap(item.id,position)){props.overlapCallback&&props.overlapCallback();return;};component.handleNodeDraw(item.id,position,getChildPosMap());break;case NodeTypes.ANCHOR:component.handleLineDraw(item.id);break;default:break;}}},function(connect){return{connectDropTarget:connect.dropTarget()};})(Topology);",{"version":3,"sources":["/Users/zhangtengjin/Desktop/byai/topology/src/lib/components/topology/index.tsx"],"names":["React","renderToStaticMarkup","DropTarget","_","classnames","selectNodes","SelectMode","Provider","defaultContext","NodeWrapper","Line","KeyCode","NodeTypes","ChangeType","LineEditType","computeCanvasPo","impactCheck","computeAnchorPo","computeNodeInputPo","computeMouseClientToCanvas","computeContentCenter","computeContentPostionY","createHashFromObjectArray","getNodeSize","shouldAutoLayout","isMatchKeyValue","computeLayout","deleteSelectedData","config","MAX_SCALE","MIN_SCALE","initialTopologyState","context","scaleNum","draggingId","Topology","props","$wrapper","$canvas","nodeSizeCache","state","dragCanvasPo","onChange","data","type","zoomIn","setState","prevState","setDraggingId","zoomOut","scrollCanvasToCenter","canvasSize","wrapperSize","contentCenter","nodes","canvasCenter","x","width","y","height","defaultScrollTop","defaultScrollLeft","scrollTop","scrollLeft","scrollCanvasToPositionY","contentPosition","customPostionHeight","cacheNodeSize","reduce","pre","cur","id","endPo","startPo","lines","impactNode","find","item","position","hasExistSameLine","start","end","canConnect","autoLayout","sortChildren","LAYOUT","initDomEvents","window","addEventListener","handleKeydown","removeDomEvents","removeEventListener","e","target","classList","keyCode","BACKSPACE","DELETE","deleteItem","selectedData","setContext","values","callback","selectNode","node","mode","onSelect","selectNodesId","map","RIGHT_NORMAL","indexOf","selectLine","dragCanvas","clientX","clientY","dX","dY","editLine","activeLine","clientPo","EDIT_START","handleHoverCurrentNode","hoverCurrentNode","clearHoverCurrentNode","handleMouseDown","itemType","getAttribute","className","getClickType","EDIT_END","includes","readOnly","jsonStr","Error","JSON","parse","origin","po","linking","err","console","log","handleMouseMove","isEditingLine","isDraggingCanvas","handleMouseUp","isLineEdit","ADD","isEqual","EDIT_LINE","clearMouseEventData","handleLineDraw","startId","lineColor","newLine","alreadyExist","anchor","split","color","ADD_LINE","handleNodeDraw","nodeId","childPosMap","posMaps","Object","keys","handleCanvasClick","ctrlKey","metaKey","renderNodes","renderTreeNode","lineHash","parent","wrapperOptions","renderDomMap","domMap","document","querySelector","createElement","setAttribute","innerHTML","anchorDecorator","anchorId","_item","body","appendChild","setTimeout","renderLines","startPointAnchorId","lineOffsetY","lineTextColor","nodeHash","isEditing","line","isSelected","some","isHighLight","getLineStartPo","undefined","getLineEndPo","index","key","getTextXY","minX","Math","min","minY","abs","fill","renderToolBars","zoomPercent","parseInt","String","toFixed","handleSelectAll","validateIsOverlap","drawId","pos","overlap","overlapOffset","getNodeOffsetPos","offsetX","offsetY","S1","S2","posMap","filter","n","filterOverlap","T1","T2","isOverlap","p","getInstance","throttle","nextProps","nextReadOnly","cancel","connectDropTarget","showBar","r","canvas","Component","hover","monitor","component","getItem","clientOffset","getClientOffset","ANCHOR","parentNode","hasAnchorExistLine","canConnectMultiLines","NORMAL_NODE","TEMPLATE_NODE","canDrop","drop","didDrop","getItemType","getDifferenceFromInitialOffset","getNodePosition","nodeDom","isChild","nodePosition","top","style","left","scalePosition","Number","replace","scrollPosition","getSourceClientOffset","getChildPosMap","curNode","dragChild","childIds","childId","childNodeDom","getElementById","ADD_NODE","overlapCallback","connect","dropTarget"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport { DropTarget, ConnectDropTarget } from 'react-dnd';\nimport _ from 'lodash';\nimport classnames from 'classnames';\nimport selectNodes, { SelectMode } from '../../utils/selectNodes';\nimport { Provider, defaultContext } from '../context';\nimport NodeWrapper from '../node-wrapper';\nimport Line from '../line';\nimport {\n    KeyCode,\n    NodeTypes,\n    IPosition,\n    ITopologyNode,\n    ITopologyLine,\n    IWrapperOptions,\n    ITopologyData,\n    ITopologyContext,\n    // eslint-disable-next-line import/named\n    ValuesOf,\n    ChangeType,\n    LineEditType,\n} from '../../declare';\nimport {\n    computeCanvasPo,\n    impactCheck,\n    computeAnchorPo,\n    computeNodeInputPo,\n    computeMouseClientToCanvas,\n    computeContentCenter,\n    computeContentPostionY,\n    createHashFromObjectArray,\n    getNodeSize,\n    shouldAutoLayout,\n    isMatchKeyValue\n} from '../../utils';\n// import layoutCalculation from '../../utils/layoutCalculation';\nimport computeLayout from '../../utils/computeLayout';\nimport deleteSelectedData from '../../utils/deleteSelectedData';\nimport config from '../../config';\nimport './index.less';\n\nexport interface ITopologyProps {\n    data: ITopologyData; // 数据 { nodes: []; lines: [] }\n    readOnly?: boolean; // 只读模式，为true时不可编辑\n    showBar?: boolean; // 是否显示工具栏\n    canConnectMultiLines?: boolean; // 控制一个锚点是否可以连接多条线\n    overlap?: boolean; // 是否允许节点覆盖，默认允许，设置 true 时不允许\n    overlapCallback?: () => void; // overlap 回调\n    overlapOffset?: {\n        offsetX?: number;\n        offsetY?: number;\n    };\n    autoLayout?: boolean; // 自动布局，当数据中没有position属性时将自动计算布局。\n    customPostionHeight?: number; // 当设置 customPostionHeight 时，画布距离顶部 customPostionHeight\n    lineColor?: {\n        [x: string]: string;\n    }; // 线条颜色映射对象 eg: {'锚点1': '#82BEFF', '锚点2': '#FFA39E'}\n    lineTextColor?: {\n        [x: string]: string;\n    }; // 线条上文字颜色映射对象 eg: {'锚点1': '#82BEFF', '锚点2': '#FFA39E'}\n    lineOffsetY?: number; // 线条起始点向上偏移量\n    startPointAnchorId?: string; // 保持所有线条起始点与 startPointAnchorId 线条一致\n    onChange?: (data: ITopologyData, type: ChangeType) => void;\n    onSelect?: (data: ITopologyData) => void;\n    getInstance?: (instance: Topology) => void; // 返回组件实例，用于调用组件内部的方法。\n    renderTreeNode?: (data: ITopologyNode, wrappers: IWrapperOptions) => React.ReactNode;\n    sortChildren?: (parent: ITopologyNode, children: ITopologyNode[]) => ITopologyNode[];\n    connectDropTarget?: ConnectDropTarget;\n}\n\ninterface ITopologyState {\n    context: ITopologyContext;\n    scaleNum: number;\n    draggingId: string;\n}\n\ninterface NodeSizeCache {\n    [id: string]: { width: number; height: number };\n}\n\ninterface IPosMap {\n    T1: {\n        x: number;\n        y: number;\n    };\n    T2: {\n        x: number;\n        y: number;\n    };\n}\n\nconst MAX_SCALE = 2;\nconst MIN_SCALE = 0.1;\n\nconst initialTopologyState = {\n    context: defaultContext,\n    scaleNum: 1,\n    draggingId: null\n} as ITopologyState;\n\nclass Topology extends React.Component<ITopologyProps, ITopologyState> {\n    $wrapper: HTMLDivElement | null;\n\n    $canvas: HTMLDivElement | null;\n\n    nodeSizeCache: NodeSizeCache = {};\n\n    state: ITopologyState = initialTopologyState;\n\n    dragCanvasPo: IPosition | null = null;\n\n    shouldAutoLayout: boolean = false;\n\n    constructor(props: ITopologyProps) {\n        super(props);\n        this.shouldAutoLayout = shouldAutoLayout(props.data.nodes);\n    }\n\n    componentWillMount() {\n        this.renderDomMap();\n    }\n\n    componentDidMount() {\n        const { getInstance, readOnly, customPostionHeight } = this.props;\n        this.editLine = _.throttle(this.editLine, 40);\n        if (!readOnly) {\n            this.initDomEvents();\n        }\n\n        if (this.$wrapper) {\n            // 自定义节点距离画布顶部高度\n            if (customPostionHeight) {\n                this.scrollCanvasToPositionY();\n            } else {\n                this.scrollCanvasToCenter();\n            }\n        }\n\n        if (this.shouldAutoLayout) {\n            this.shouldAutoLayout = false;\n            this.autoLayout();\n        }\n\n        if (getInstance) {\n            getInstance(this);\n        }\n    }\n\n    componentWillReceiveProps(nextProps: ITopologyProps) {\n        const { readOnly } = this.props;\n        const { readOnly: nextReadOnly } = nextProps;\n        this.renderDomMap(nextProps);\n        this.shouldAutoLayout = shouldAutoLayout(nextProps.data.nodes);\n        if (readOnly && !nextReadOnly) {\n            this.initDomEvents();\n        }\n        if (!readOnly && nextReadOnly) {\n            this.removeDomEvents();\n        }\n    }\n\n    componentDidUpdate() {\n        if (this.shouldAutoLayout) {\n            this.shouldAutoLayout = false;\n            this.autoLayout();\n        }\n    }\n\n    componentWillUnmount() {\n        // @ts-ignore\n        if (typeof this.editLine.cancel === \"function\") {\n            // @ts-ignore\n            this.editLine.cancel();\n        }\n\n        this.removeDomEvents();\n    }\n\n    onChange = (data: ITopologyData, type: ChangeType) => {\n        const { onChange } = this.props;\n        if (!onChange) {\n            return;\n        }\n        onChange(data, type);\n    };\n\n    scaleNum = 1;\n\n    zoomIn = () => {\n        this.setState((prevState: ITopologyState) => {\n            const scaleNum = prevState.scaleNum > MIN_SCALE + 0.1 ? prevState.scaleNum - 0.1 : MIN_SCALE;\n            this.scaleNum = scaleNum;\n            return { scaleNum };\n        });\n        this.setDraggingId(null);\n    };\n\n    zoomOut = () => {\n        this.setState((prevState: ITopologyState) => {\n            const scaleNum = prevState.scaleNum < MAX_SCALE ? prevState.scaleNum + 0.1 : MAX_SCALE;\n            this.scaleNum = scaleNum;\n            return { scaleNum };\n        });\n        this.setDraggingId(null);\n    };\n\n    scrollCanvasToCenter = () => {\n        if (!this.$wrapper || !this.$canvas) {\n            return;\n        }\n        const canvasSize = getNodeSize(this.$canvas);\n        const wrapperSize = getNodeSize(this.$wrapper);\n        const contentCenter = computeContentCenter(this.props.data.nodes);\n        const canvasCenter = {\n            x: canvasSize.width / 2,\n            y: canvasSize.height / 2\n        };\n        const defaultScrollTop = (canvasSize.height - wrapperSize.height) / 2;\n        const defaultScrollLeft = (canvasSize.width - wrapperSize.width) / 2;\n        if (!contentCenter) {\n            this.$wrapper.scrollTop = defaultScrollTop;\n            this.$wrapper.scrollLeft = defaultScrollLeft;\n        } else {\n            this.$wrapper.scrollTop = defaultScrollTop + (contentCenter.y - canvasCenter.y);\n            this.$wrapper.scrollLeft = defaultScrollLeft + (contentCenter.x - canvasCenter.x);\n        }\n    };\n\n    /**\n     *  定位至画布顶部距离\n     * @returns\n     */\n    scrollCanvasToPositionY = () => {\n        if (!this.$wrapper || !this.$canvas) {\n            return;\n        }\n        const canvasSize = getNodeSize(this.$canvas);\n        const wrapperSize = getNodeSize(this.$wrapper);\n        const contentPosition = computeContentPostionY(this.props.data.nodes);\n        const canvasCenter = {\n            x: canvasSize.width / 2,\n            y: canvasSize.height / 2\n        };\n        const defaultScrollTop = (canvasSize.height - wrapperSize.height) / 2;\n        const defaultScrollLeft = (canvasSize.width - wrapperSize.width) / 2;\n        if (!contentPosition) {\n            this.$wrapper.scrollTop = defaultScrollTop;\n            this.$wrapper.scrollLeft = defaultScrollLeft;\n        } else {\n            this.$wrapper.scrollTop = contentPosition.y - this.props.customPostionHeight;\n            this.$wrapper.scrollLeft = defaultScrollLeft + (contentPosition.x - canvasCenter.x);\n        }\n    };\n\n    cacheNodeSize = () => {\n        const {\n            data: { nodes }\n        } = this.props;\n        // 已节点id为键值，缓存节点的宽和高，避免碰撞检测时频繁操作DOM\n        this.nodeSizeCache = nodes.reduce(\n            (pre: NodeSizeCache, cur: ITopologyNode) => ({\n                ...pre,\n                [cur.id]: getNodeSize(cur.id)\n            }),\n            {}\n        );\n    };\n\n    impactCheck = (endPo: IPosition, startPo: IPosition, id?: string) => {\n        const {\n            data: { nodes, lines }\n        } = this.props;\n        const impactNode = nodes.find((item) => {\n            if (!this.nodeSizeCache[item.id]) {\n                this.nodeSizeCache[item.id] = getNodeSize(item.id);\n            }\n            return (\n                this.nodeSizeCache[item.id]\n                && impactCheck(\n                    endPo,\n                    this.nodeSizeCache[item.id],\n                    item.position as IPosition\n                )\n            );\n        });\n        // 起点和终点是同一节点\n        if (\n            impactNode\n            && impactCheck(\n                startPo,\n                this.nodeSizeCache[impactNode.id],\n                impactNode.position as IPosition\n            )\n        ) {\n            return null;\n        }\n\n        // 线已存在情况下\n        const hasExistSameLine = impactNode && lines.find(item => item.start === id && item.end === impactNode.id);\n        if (hasExistSameLine) return null;\n\n        // 节点不可被连接\n        if (impactNode && impactNode.canConnect === false) return null;\n\n        return impactNode ? impactNode.id : null;\n    };\n\n    autoLayout = () => {\n        const { data, sortChildren } = this.props;\n        this.onChange(\n            {\n                ...data,\n                nodes: computeLayout(data, { sortChildren })\n            },\n            ChangeType.LAYOUT\n        );\n    };\n\n    initDomEvents = () => {\n        window.addEventListener(\"keydown\", this.handleKeydown);\n    };\n\n    removeDomEvents = () => {\n        window.removeEventListener(\"keydown\", this.handleKeydown);\n    };\n\n    handleKeydown = (e: KeyboardEvent) => {\n        // eslint-disable-next-line\n        const { classList = [] } = e.target as any;\n        // 左侧的搜索输入框回删事件不触发话术更改\n        if (classList[0] === \"ant-input\") {\n            return;\n        }\n        switch (e.keyCode) {\n            case KeyCode.BACKSPACE:\n            case KeyCode.DELETE:\n                this.deleteItem();\n                break;\n            default:\n                break;\n        }\n    };\n\n    deleteItem = () => {\n        const { data } = this.props;\n        const { selectedData } = this.state.context;\n        this.onChange(\n            deleteSelectedData(data, selectedData),\n            ChangeType.DELETE\n        );\n    };\n\n    setDraggingId = (id) => {\n        this.setState({\n            draggingId: id,\n        });\n    }\n\n    setContext = (values: ValuesOf<ITopologyContext>, callback?: Function) => {\n        const { context } = this.state;\n        this.setState({ context: { ...context, ...values } }, () => {\n            if (callback) {\n                callback();\n            }\n        });\n    };\n\n    selectNode = (node: ITopologyNode, mode: SelectMode) => {\n        const { data, onSelect } = this.props;\n        const {\n            context: { selectedData }\n        } = this.state;\n        const selectNodesId = selectedData.nodes.map(item => item.id);\n        if (\n            mode === SelectMode.RIGHT_NORMAL\n            && selectNodesId.indexOf(node.id) !== -1\n        ) {\n            onSelect(selectedData);\n            return;\n        }\n        this.setContext(\n            {\n                selectedData: selectNodes({ data, selectedData })({\n                    node,\n                    mode\n                })\n            },\n            () => {\n                if (onSelect) {\n                    onSelect(this.state.context.selectedData);\n                }\n            }\n        );\n    };\n\n    selectLine = (data: ITopologyData) => {\n        this.setContext(\n            {\n                selectedData: data\n            },\n            () => {\n                const { onSelect } = this.props;\n                if (onSelect) {\n                    onSelect(this.state.context.selectedData);\n                }\n            }\n        );\n    };\n\n    dragCanvas = (clientX: number, clientY: number) => {\n        if (!this.$wrapper) {\n            return;\n        }\n        const dX = this.dragCanvasPo!.x - clientX;\n        const dY = this.dragCanvasPo!.y - clientY;\n        this.dragCanvasPo = { x: clientX, y: clientY };\n        this.$wrapper.scrollTop = this.$wrapper.scrollTop + dY;\n        this.$wrapper.scrollLeft = this.$wrapper.scrollLeft + dX;\n    };\n\n    editLine = (clientX: number, clientY: number) => {\n        const { activeLine } = this.state.context;\n        if (!this.$wrapper || !activeLine) {\n            return;\n        }\n\n        const clientPo = computeMouseClientToCanvas(\n            clientX,\n            clientY,\n            this.$wrapper\n        );\n        const impactNode = this.impactCheck(\n            clientPo,\n            activeLine![\n                activeLine.type === LineEditType.EDIT_START ? \"end\" : \"start\"\n            ]\n        );\n\n        this.setContext({\n            impactNode,\n            activeLine: {\n                ...activeLine,\n                [activeLine.type]: clientPo\n            }\n        });\n    };\n\n    handleHoverCurrentNode = (node) => {\n        this.setContext({\n            hoverCurrentNode: node\n        });\n    }\n\n    clearHoverCurrentNode = () => {\n        this.setContext({\n            hoverCurrentNode: null\n        });\n    }\n\n    handleMouseDown = (\n        e: React.MouseEvent<HTMLDivElement | SVGCircleElement>\n    ) => {\n        // @ts-ignore\n        const itemType = e.target.getAttribute(\"data-type\");\n        // @ts-ignore\n        const { className } = e.target;\n        const getClickType = () => {\n            // @ts-ignore\n            if (\n                // @ts-ignore\n                [LineEditType.EDIT_START, LineEditType.EDIT_END].includes(\n                    itemType || \"\"\n                )\n            ) {\n                return \"CLICK_LINE_POINT\";\n            } else if (\n                typeof className === \"string\"\n                && className.includes(\"topology-canvas\")\n            ) {\n                return \"CLICK_CANVAS\";\n            }\n            return \"\";\n        };\n        switch (getClickType()) {\n            case \"CLICK_CANVAS\":\n                this.dragCanvasPo = { x: e.clientX, y: e.clientY };\n                break;\n            case \"CLICK_LINE_POINT\":\n                if (this.props.readOnly) {\n                    break;\n                }\n                try {\n                    // @ts-ignore\n                    const jsonStr = e.target.getAttribute(\"data-json\");\n                    if (typeof jsonStr !== \"string\" || !jsonStr) {\n                        throw new Error(\"线段起点无数据\");\n                    }\n                    const { origin, po } = JSON.parse(jsonStr);\n                    this.setContext({\n                        linking: true,\n                        activeLine: {\n                            origin,\n                            start: po.start,\n                            end: po.end,\n                            type: itemType\n                        }\n                    });\n                } catch (err) {\n                    // eslint-disable-next-line no-console\n                    console.log(err);\n                }\n                break;\n            default:\n                break;\n        }\n    };\n\n    handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\n        const { activeLine } = this.state.context;\n        // @ts-ignore\n        const isEditingLine = activeLine\n        // @ts-ignore\n            && [LineEditType.EDIT_START, LineEditType.EDIT_END].includes(\n                activeLine.type\n            );\n        const isDraggingCanvas = this.dragCanvasPo;\n        if (!isEditingLine && !isDraggingCanvas) {\n            return;\n        }\n        if (isDraggingCanvas) {\n            this.dragCanvas(e.clientX, e.clientY);\n        }\n        if (isEditingLine && !this.props.readOnly) {\n            this.editLine(e.clientX, e.clientY);\n        }\n    };\n\n    handleMouseUp = () => {\n        const {\n            data: { lines },\n            readOnly\n        } = this.props;\n        const { activeLine, impactNode } = this.state.context;\n        const isLineEdit = activeLine && activeLine.type !== LineEditType.ADD;\n        if (isLineEdit && impactNode && !readOnly) {\n            const { type, origin } = activeLine!;\n            if (type === LineEditType.EDIT_END) {\n                this.onChange(\n                    {\n                        ...this.props.data,\n                        lines: lines.map(item => (_.isEqual(item, origin!)\n                            ? { ...item, end: impactNode }\n                            : item))\n                    },\n                    ChangeType.EDIT_LINE\n                );\n            }\n        }\n        this.clearMouseEventData();\n    };\n\n    clearMouseEventData = () => {\n        this.dragCanvasPo = null;\n        this.setContext({ activeLine: null, linking: false, impactNode: null });\n    };\n\n    handleLineDraw = (startId: string) => {\n        const { data, lineColor = {} } = this.props;\n        const { lines } = this.props.data;\n        const {\n            context: { impactNode }\n        } = this.state;\n        if (impactNode) {\n            const newLine = { start: startId, end: impactNode };\n            const alreadyExist = lines.find(item => _.isEqual(item, newLine));\n            const anchor = startId.split(\"-\")[1] || \"\";\n            // eslint-disable-next-line\n            console.log(\"anchor\", anchor);\n            if (!alreadyExist) {\n                this.onChange(\n                    {\n                        ...data,\n                        lines: [\n                            ...data.lines,\n                            { ...newLine, color: lineColor[anchor] }\n                        ]\n                    },\n                    ChangeType.ADD_LINE\n                );\n            }\n        }\n        this.clearMouseEventData();\n    };\n\n    handleNodeDraw = (nodeId: string, position: IPosition, childPosMap?: {\n        [key: string]: {\n            x: number;\n            y: number;\n        };\n    }) => {\n        const { data } = this.props;\n        const posMaps = {\n            [nodeId]: position,\n            ...childPosMap\n        };\n        this.onChange(\n            {\n                ...data,\n                // @ts-ignore\n                nodes: data.nodes.map(item => (Object.keys(posMaps).includes(item.id) ? { ...item, position: posMaps[item.id] } : item))\n            },\n            ChangeType.LAYOUT\n        );\n    };\n\n    handleCanvasClick = (e: React.MouseEvent<HTMLDivElement>) => {\n        // @ts-ignore\n        const { className } = e.target;\n        if (\n            typeof className === \"string\"\n            && className.includes(\"topology-canvas\")\n        ) {\n            // 当按住cmd或者ctrl的时候，左键点击背景图层的时候，不会清楚选中的数据。\n            if (e.ctrlKey || e.metaKey) {\n                return;\n            }\n            this.setContext({ selectedData: { nodes: [], lines: [] } }, () => {\n                const { onSelect } = this.props;\n                if (onSelect) {\n                    onSelect(this.state.context.selectedData);\n                }\n            });\n        }\n        this.setDraggingId(null);\n    };\n\n    renderNodes = () => {\n        const {\n            data: { nodes, lines },\n            renderTreeNode,\n            readOnly\n        } = this.props;\n        const {\n            scaleNum,\n            draggingId,\n        } = this.state;\n        if (!renderTreeNode) {\n            return null;\n        }\n        const lineHash = lines.reduce((pre, cur) => {\n            const { start, end } = cur;\n            const [parent] = start.split(\"-\");\n            return { ...pre, [parent]: true, [end]: true };\n        }, {}) as { [id: string]: ITopologyLine };\n\n        return nodes.map(item => (\n            <NodeWrapper\n                onMouseEnter={this.handleHoverCurrentNode}\n                onMouseLeave={this.clearHoverCurrentNode}\n                key={item.id}\n                id={`${item.id}`}\n                data={item}\n                scaleNum={scaleNum}\n                draggingId={draggingId}\n                setDraggingId={this.setDraggingId}\n                readOnly={readOnly}\n                isolated={!lineHash[item.id]}\n                onSelect={this.selectNode}\n            >\n                {(wrapperOptions: IWrapperOptions) =>\n                    /* eslint-disable */\n                    renderTreeNode(item, wrapperOptions)\n                }\n            </NodeWrapper>\n        ));\n    };\n\n    renderDomMap = (props: ITopologyProps = this.props) => {\n        const {\n            data: { nodes },\n            renderTreeNode\n        } = props;\n        if (!renderTreeNode) {\n            return;\n        }\n        let domMap = document.querySelector(\"#topology-dom-map\");\n        if (!domMap) {\n            domMap = document.createElement(\"div\");\n            domMap.setAttribute(\"id\", \"topology-dom-map\");\n        }\n        domMap.innerHTML = renderToStaticMarkup(\n            <div>\n                {nodes.map(item => (\n                    <div\n                        key={item.id}\n                        id={`dom-map-${item.id}`}\n                        className=\"dom-map-wrapper\"\n                    >\n                        {renderTreeNode(item, {\n                            anchorDecorator: ({ anchorId }) => (\n                                _item: React.ReactNode\n                            ) => (\n                                <div\n                                    id={`dom-map-${item.id}-${anchorId}`}\n                                    key={anchorId}\n                                    className=\"dom-map-wrapper\"\n                                >\n                                    {_item}\n                                </div>\n                            )\n                        })}\n                    </div>\n                ))}\n            </div>\n        );\n        document.body.appendChild(domMap);\n        setTimeout(this.cacheNodeSize, 1000);\n    };\n\n    renderLines = () => {\n        const {\n            data: { lines, nodes },\n            startPointAnchorId,\n            lineOffsetY,\n            readOnly,\n            lineTextColor\n        } = this.props;\n        const { activeLine, selectedData, hoverCurrentNode } = this.state.context;\n        const nodeHash = createHashFromObjectArray(nodes, \"id\") as {\n            [id: string]: ITopologyNode;\n        };\n\n        const isEditing = (line: ITopologyLine) =>\n            activeLine &&\n            activeLine.origin &&\n            _.isEqual(line, activeLine.origin);\n        const isSelected = (line: ITopologyLine) =>\n            isEditing(line) || _.some(selectedData.lines, line);\n\n        // @ts-ignore\n        const isHighLight = (line: ITopologyLine) => {\n            if(!hoverCurrentNode) return false;\n            const { id } = hoverCurrentNode;\n            if(line.start.split(\"-\")[0] === id || line.end === id) return true;\n        }\n\n        const getLineStartPo = (line: ITopologyLine) => {\n            if (\n                isEditing(line) &&\n                activeLine.type === LineEditType.EDIT_START\n            ) {\n                return activeLine.start;\n            }\n\n            // 这里特殊处理下，目的是保持所有锚点的起始点位置与 startPointAnchorId 锚点位置一致\n            return computeAnchorPo(\n                // `dom-map-${line.start}`,\n               `dom-map-${startPointAnchorId === undefined ? line.start : `${line.start.split(\"-\")[0]}-${startPointAnchorId}`}`,\n                nodeHash[line.start.split(\"-\")[0]]\n            );\n        };\n        const getLineEndPo = (line: ITopologyLine) => {\n            if (isEditing(line) && activeLine.type === LineEditType.EDIT_END) {\n                return activeLine.end;\n            }\n            return computeNodeInputPo(nodeHash[line.end]);\n        };\n\n        return (\n            <svg className=\"topology-svg\">\n                {lines.map((line, index) => {\n                    const start = getLineStartPo(line);\n                    const end = getLineEndPo(line);\n                    if (!start || !end) {\n                        return null;\n                    }\n\n                    const key = `${line.start}-${line.end}`;\n                    const anchorId = line.start.split(\"-\")[1];\n                    const getTextXY = () => {\n                        const minX = Math.min(start.x, end.x);\n                        const minY = Math.min(start.y, end.y);\n                        const x = minX + Math.abs((start.x - end.x)/2);\n                        const y = minY + Math.abs((start.y - end.y)/2)\n                        return {\n                            x,\n                            y\n                        }\n                    }\n\n                    return (\n                        <>\n                            {lineTextColor && (\n                                <text x={getTextXY().x} y={getTextXY().y} key={index} style={{\n                                    fill: lineTextColor[anchorId]\n                                }}>{anchorId === startPointAnchorId ? null : anchorId}</text>\n                            )}\n                            <Line\n                                key={key}\n                                lineOffsetY={lineOffsetY}\n                                data={line}\n                                start={start}\n                                end={end}\n                                onSelect={this.selectLine}\n                                selected={isSelected(line)}\n                                highLight={isHighLight(line)}\n                                readOnly={readOnly}\n                            />\n                        </>\n\n                    );\n                })}\n                {activeLine && activeLine.type === LineEditType.ADD && (\n                    <Line {...activeLine} />\n                )}\n            </svg>\n        );\n    };\n\n    renderToolBars = () => {\n        const { scaleNum } = this.state;\n        /* eslint-disable */\n        // @ts-ignore\n        const zoomPercent = `${parseInt(String(scaleNum.toFixed(1) * 100))}%`;\n        return (\n            <div className=\"topology-tools\">\n                <div\n                    className=\"topology-tools-btn\"\n                    id=\"scroll-canvas-to-center\"\n                    onClick={this.scrollCanvasToCenter}\n                >\n                    <img\n                        src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTYwMzI3NjY4NDk5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjExMzciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEzLjc5OTY0OSAyOTUuNzQyMjM4Yy0xMTguMTc2OTE5IDAtMjE0LjE1ODE3MiA5Ni4xODEyMTUtMjE0LjE1ODE3MyAyMTQuMTU4MTcyIDAgMTE4LjE3NjkxOSA5Ni4xODEyMTUgMjE0LjE1ODE3MiAyMTQuMTU4MTczIDIxNC4xNTgxNzIgMTE3Ljk3Njk1OCAwIDIxNC4xNTgxNzItOTUuNzgxMjkzIDIxNC4xNTgxNzItMjEzLjk1ODIxMXMtOTYuMTgxMjE1LTIxNC4zNTgxMzMtMjE0LjE1ODE3Mi0yMTQuMzU4MTMzeiBtMCAzNjcuMzI4MjU2Yy04NC4zODM1MTkgMC0xNTIuOTcwMTIzLTY4LjU4NjYwNC0xNTIuOTcwMTI0LTE1Mi45NzAxMjNzNjguNTg2NjA0LTE1Mi45NzAxMjMgMTUyLjk3MDEyNC0xNTIuOTcwMTIzIDE1Mi45NzAxMjMgNjguNTg2NjA0IDE1Mi45NzAxMjMgMTUyLjk3MDEyMy02OC41ODY2MDQgMTUyLjk3MDEyMy0xNTIuOTcwMTIzIDE1Mi45NzAxMjN6IiBmaWxsPSIjMzMzMzMzIiBwLWlkPSIxMTM4Ij48L3BhdGg+PHBhdGggZD0iTTk5MS4zMDYzODUgNDgwLjUwNjE1MUg5MTMuOTIxNWMtNy4xOTg1OTQtOTYuNTgxMTM2LTQ4LjE5MDU4OC0xODYuMzYzNjAxLTExNy4zNzcwNzUtMjU1LjU1MDA4OHMtMTU4Ljk2ODk1MS0xMTAuMTc4NDgxLTI1NS41NTAwODgtMTE3LjM3NzA3NVYzMC41OTQwMjVjMC0xNi43OTY3MTktMTMuNzk3MzA1LTMwLjU5NDAyNS0zMC41OTQwMjUtMzAuNTk0MDI1cy0zMC41OTQwMjUgMTMuNzk3MzA1LTMwLjU5NDAyNCAzMC41OTQwMjV2NzYuOTg0OTYzYy05Ni4zODExNzYgNy4xOTg1OTQtMTg2LjM2MzYwMSA0OC4xOTA1ODgtMjU1LjU1MDA4OCAxMTcuMzc3MDc1UzExNC4wNzc3MTkgMzgzLjcyNTA1NCAxMDYuODc5MTI1IDQ4MC41MDYxNTFIMzAuNjk0MDA1Yy0xNi43OTY3MTkgMC0zMC41OTQwMjUgMTMuNzk3MzA1LTMwLjU5NDAyNSAzMC41OTQwMjVzMTMuNzk3MzA1IDMwLjU5NDAyNSAzMC41OTQwMjUgMzAuNTk0MDI0aDc2LjE4NTEyYzcuMTk4NTk0IDk2LjU4MTEzNiA0OC4xOTA1ODggMTg2LjM2MzYwMSAxMTcuMzc3MDc1IDI1NS41NTAwODhzMTU4Ljk2ODk1MSAxMTAuMTc4NDgxIDI1NS41NTAwODggMTE3LjM3NzA3NXY3OC43ODQ2MTJjMCAxNi43OTY3MTkgMTMuNzk3MzA1IDMwLjU5NDAyNSAzMC41OTQwMjQgMzAuNTk0MDI1czMwLjU5NDAyNS0xMy43OTczMDUgMzAuNTk0MDI1LTMwLjU5NDAyNXYtNzguNzg0NjEyYzk2LjM4MTE3Ni03LjE5ODU5NCAxODYuMzYzNjAxLTQ4LjE5MDU4OCAyNTUuNTUwMDg4LTExNy4zNzcwNzVzMTEwLjE3ODQ4MS0xNTguOTY4OTUxIDExNy4zNzcwNzUtMjU1LjU1MDA4OGg3Ny4zODQ4ODVjMTYuNzk2NzE5IDAgMzAuNTk0MDI1LTEzLjc5NzMwNSAzMC41OTQwMjUtMzAuNTk0MDI0IDAtMTYuOTk2NjgtMTMuNzk3MzA1LTMwLjU5NDAyNS0zMC41OTQwMjUtMzAuNTk0MDI1ek03NTMuMTUyOSA3NTMuODUyNzYzYy02NC43ODczNDYgNjQuNzg3MzQ2LTE1MS4xNzA0NzUgMTAwLjU4MDM1NS0yNDIuNzUyNTg4IDEwMC41ODAzNTYtOTEuNzgyMDc0IDAtMTc3Ljk2NTI0MS0zNS43OTMwMDktMjQyLjc1MjU4Ny0xMDAuNTgwMzU2LTY0Ljc4NzM0Ni02NC43ODczNDYtMTAwLjU4MDM1NS0xNTEuMTcwNDc1LTEwMC41ODAzNTUtMjQyLjc1MjU4N3MzNS43OTMwMDktMTc3Ljk2NTI0MSAxMDAuNTgwMzU1LTI0Mi43NTI1ODhjNjQuNzg3MzQ2LTY0Ljc4NzM0NiAxNTEuMTcwNDc1LTEwMC41ODAzNTUgMjQyLjc1MjU4Ny0xMDAuNTgwMzU1IDkxLjc4MjA3NCAwIDE3Ny45NjUyNDEgMzUuNzkzMDA5IDI0Mi43NTI1ODggMTAwLjU4MDM1NSA2NC43ODczNDYgNjQuNzg3MzQ2IDEwMC41ODAzNTUgMTUxLjE3MDQ3NSAxMDAuNTgwMzU1IDI0Mi43NTI1ODhzLTM1LjU5MzA0OCAxNzcuOTY1MjQxLTEwMC41ODAzNTUgMjQyLjc1MjU4N3oiIGZpbGw9IiMzMzMzMzMiIHAtaWQ9IjExMzkiPjwvcGF0aD48L3N2Zz4=\"\n                        alt=\"\"\n                    />\n                    <div className=\"tooltip\">定位中心</div>\n                </div>\n                <div\n                    className=\"topology-tools-btn\"\n                    id=\"auto-layout\"\n                    onClick={this.autoLayout}\n                >\n                    <img\n                        src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTYwMzI3NjU0MDc4IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwMjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNODg1LjkyNzYxNyA2NzQuMzAwMTMyVjQ5Ny42NDYxMTNINTQwLjc3MTIyVjM1My44Mjk5MjRoMzQ1LjE1NzQyMVYxMjMuNjk3MDA2SDEzOC4wNzAzMzZ2MjMwLjEzMjkxOGgzNDUuMTU3NDIxdjE0My44MTYxODlIMTM4LjA3MDMzNnYxNzYuNjU0MDE5Yy00OS40Nzc3NzkgMTIuODYyOTMzLTg2LjI4ODA3NiA1Ny40OTc0MTQtODYuMjg4MDc2IDExMC45NTA3MjkgMCA2My40NTMwNDQgNTEuNTk4MDY1IDExNS4wNTIxMzMgMTE1LjA1NDE3OSAxMTUuMDUyMTMzIDYzLjQ1MjAyMSAwIDExNS4wNTAwODYtNTEuNTk5MDg5IDExNS4wNTAwODYtMTE1LjA1MjEzMyAwLTUzLjQ1MzMxNi0zNi44MTAyOTctOTguMDg3Nzk2LTg2LjI4ODA3Ni0xMTAuOTUwNzI5VjU1NS4xNDQ1NWgyODcuNjMwMzMxdjExOS4xNTQ1NTljLTQ5LjQ5MTA4MiAxMi44NjI5MzMtODYuMjg4MDc2IDU3LjQ5NzQxNC04Ni4yODgwNzYgMTEwLjk1MDcyOSAwIDYzLjQ1MzA0NCA1MS41OTkwODkgMTE1LjA1MjEzMyAxMTUuMDY2NDU5IDExNS4wNTIxMzMgNjMuNDI1NDE1IDAgMTE1LjA1NDE3OS01MS41OTkwODkgMTE1LjA1NDE3OS0xMTUuMDUyMTMzIDAtNTMuNDUzMzE2LTM2Ljc5ODAxNy05OC4wODc3OTYtODYuMjg5MDk5LTExMC45NTA3MjlWNTU1LjE0NDU1aDI4Ny42MzAzMzF2MTE5LjE1NDU1OWMtNDkuNDkzMTI5IDEyLjg2MjkzMy04Ni4yODcwNTMgNTcuNDk3NDE0LTg2LjI4NzA1MyAxMTAuOTUwNzI5IDAgNjMuNDUzMDQ0IDUxLjU2OTQxMyAxMTUuMDUyMTMzIDExNS4wNTExMSAxMTUuMDUyMTMzIDYzLjQyNDM5MSAwIDExNS4wNTMxNTYtNTEuNTk5MDg5IDExNS4wNTMxNTYtMTE1LjA1MjEzMy0wLjAwMjA0Ny01My40NTMzMTYtMzYuODAwMDY0LTk4LjA4Njc3My04Ni4yOTIxNy0xMTAuOTQ5NzA2ek0xOTUuNTk3NDI2IDE4MS4yMjQwOTZoNjMyLjgwNDEyNXYxMTUuMDUyMTMySDE5NS41OTc0MjZWMTgxLjIyNDA5NnogbTI4Ljc2NDA1NiA2MDQuMDI2NzY1YzAgMzEuNzEyMTk2LTI1LjgxNDg5NCA1Ny41NTQ3MTktNTcuNTI2MDY2IDU3LjU1NDcxOS0zMS43MTQyNDIgMC01Ny41MjcwOS0yNS44NDI1MjMtNTcuNTI3MDktNTcuNTU0NzE5IDAtMzEuNzE0MjQyIDI1LjgxMjg0Ny01Ny40OTg0MzcgNTcuNTI3MDktNTcuNDk4NDM3IDMxLjcxMjE5Ni0wLjAwMTAyMyA1Ny41MjYwNjYgMjUuNzgzMTcxIDU3LjUyNjA2NiA1Ny40OTg0Mzd6IG0zNDUuMTcxNzQ3IDBjMCAzMS43MTIxOTYtMjUuODQxNSA1Ny41NTQ3MTktNTcuNTI3MDg5IDU3LjU1NDcxOS0zMS43MjQ0NzUgMC01Ny41MzkzNjktMjUuODQyNTIzLTU3LjUzOTM2OS01Ny41NTQ3MTkgMC0zMS43MTQyNDIgMjUuODE1OTE3LTU3LjQ5ODQzNyA1Ny41MzkzNjktNTcuNDk4NDM3IDMxLjY4NTU5LTAuMDAxMDIzIDU3LjUyNzA5IDI1Ljc4MzE3MSA1Ny41MjcwODkgNTcuNDk4NDM3eiBtMjg3LjYzMTM1NSA1Ny41NTQ3MTljLTMxLjc0MTg3MiAwLTU3LjUyODExMy0yNS44NDI1MjMtNTcuNTI4MTEzLTU3LjU1NDcxOSAwLTMxLjcxNDI0MiAyNS43ODYyNDEtNTcuNDk4NDM3IDU3LjUyODExMy01Ny40OTg0MzcgMzEuNjg1NTkgMCA1Ny41MjcwOSAyNS43ODQxOTUgNTcuNTI3MDkgNTcuNDk4NDM3IDAgMzEuNzEyMTk2LTI1Ljg0MTUgNTcuNTU0NzE5LTU3LjUyNzA5IDU3LjU1NDcxOXoiIGZpbGw9IiMyYzJjMmMiIHAtaWQ9IjEwMjMiPjwvcGF0aD48L3N2Zz4=\"\n                        alt=\"\"\n                    />\n                    <div className=\"tooltip\">自动布局</div>\n                </div>\n\n                <div className=\"topology-tools-zoom\" onClick={this.zoomIn}>\n                    <img\n                        src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIxOTIzNzE5OTI0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwOTIwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjEyOCIgaGVpZ2h0PSIxMjgiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMi42MTY5NDIgNjQuMTg2NjczYzYxLjcyMDU1MyAwIDExOS43OTA3ODIgMTEuNzc5ODEzIDE3NC4yMTEwODUgMzUuMzM5NDRzMTAxLjcwNjA0MyA1NS40MTU0MjggMTQxLjg1NzQyMSA5NS41Njc0MDVjNDAuMTUxMzc3IDQwLjE1MTk3NyA3Mi4wMDcxNzkgODcuMjcxODMgOTUuNTY3NDA1IDE0MS4zNTk3NTggMjMuNTYwMjI2IDU0LjA4NzcyOSAzNS4zNDAwMzkgMTExLjk5MjI2OSAzNS4zMzk0NCAxNzMuNzEzNDIyLTAuMDAwNiA2MS43MjA5NTMtMTEuNzgwMjEzIDExOS43OTEzODEtMzUuMzM5NDQgMTc0LjIxMTA4NS0yMy41NTkwMjcgNTQuNDE5NzAzLTU1LjQxNTAyOSAxMDEuNzA1NDQ0LTk1LjU2NzQwNSAxNDEuODU3NDIxLTQwLjE1MjU3NyA0MC4xNTE5NzctODcuNDM4MzE3IDcyLjAwNzc3OS0xNDEuODU3NDIxIDk1LjU2NzQwNS01NC40MTkxMDQgMjMuNTU5NjI3LTExMi40ODkzMzIgMzUuMzM5NDQtMTc0LjIxMTA4NSAzNS4zMzk0NHMtMTE5LjYyNjA5NC0xMS43Nzk4MTMtMTczLjcxMzQyMi0zNS4zMzk0NGMtNTQuMDg3MzI5LTIzLjU1OTYyNy0xMDEuMjA3MTgyLTU1LjQxNTQyOC0xNDEuMzU5NzU4LTk1LjU2NzQwNS00MC4xNTI1NzctNDAuMTUxOTc3LTcyLjAwODM3OC04Ny40Mzc3MTctOTUuNTY3NDA1LTE0MS44NTc0MjFzLTM1LjMzODg0LTExMi40ODk5MzItMzUuMzM5NDQtMTc0LjIxMTA4NWMtMC4wMDA2LTYxLjcyMTE1MyAxMS43NzkyMTQtMTE5LjYyNTQ5NCAzNS4zMzk0NC0xNzMuNzEzNDIyczU1LjQxNjAyOC0xMDEuMjA3NzgxIDk1LjU2NzQwNS0xNDEuMzU5NzU4IDg3LjI3MTIzLTcyLjAwNzc3OSAxNDEuMzU5NzU4LTk1LjU2NzQwNVM0NTAuODk2NTg4IDY0LjE4Njg3MyA1MTIuNjE2OTQyIDY0LjE4NjY3M3pNNzM0LjYxMDgzIDU3MC44OTEzMjhjMTkuOTA5NzAxIDAgMzcuODI4NTUyLTUuMTQzMzEzIDUzLjc1NjE1My0xNS40Mjk5MzkgMTUuOTI3NjAxLTEwLjI4NjYyNiAyMy44OTE0MDItMjUuNzE2NTY0IDIzLjg5MTQwMi00Ni4yODk4MTYgMC0xOS45MDk3MDEtNy45NjM4MDEtMzQuNjc2Mjg5LTIzLjg5MTQwMi00NC4yOTkzNjUtMTUuOTI3NjAxLTkuNjIzMDc2LTMzLjg0NjI1Mi0xNC40MzQ2MTMtNTMuNzU2MTUzLTE0LjQzNDgxM0wyOTQuNjA0MTU0IDQ1MC40MzczOTVjLTE5LjkwOTcwMSAwLTM4LjE2MDUyNyA0LjgxMTUzOC01NC43NTIyNzggMTQuNDM0ODEzLTE2LjU5MTc1MSA5LjYyMzA3Ni0yNC44ODc1MjYgMjQuMzg5NjY0LTI0Ljg4NzUyNiA0NC4yOTkzNjUgMCAyMC41NzMyNTEgOC4yOTU3NzUgMzYuMDAzMTkgMjQuODg3NTI2IDQ2LjI4OTgxNiAxNi41OTE3NTEgMTAuMjg2NjI2IDM0Ljg0MjM3NyAxNS40Mjk5MzkgNTQuNzUyMjc4IDE1LjQyOTkzOUw3MzQuNjEwODMgNTcwLjg5MTMyOCA3MzQuNjEwODMgNTcwLjg5MTMyOHoiIHAtaWQ9IjEwOTIxIiBmaWxsPSIjOUZBMkE4Ij48L3BhdGg+PC9zdmc+\"\n                        alt=\"\"\n                    />\n                </div>\n\n                <div className=\"topology-tools-percent\">{zoomPercent}</div>\n                <div className=\"topology-tools-zoom\" onClick={this.zoomOut}>\n                    <img\n                        src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIxOTIzNDA4MzQyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjgwNSIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC43NzgxMDY5LjAuaTIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTE3LjEyIDQzLjkxOTM2Yy0yNTguNzM0MDggMC00NjguNDggMjA5Ljc0NTkyLTQ2OC40OCA0NjguNDhzMjA5Ljc0NTkyIDQ2OC40OCA0NjguNDggNDY4LjQ4IDQ2OC40OC0yMDkuNzQ1OTIgNDY4LjQ4LTQ2OC40OC0yMDkuNzQ1OTItNDY4LjQ4LTQ2OC40OC00NjguNDh6TTc0Mi4yMzg3MiA1NjUuNzZINTcwLjg4djE3MS43OTkwNGMwIDI5LjU2OC0yNC4xOTIgNTMuNzYtNTMuNzYgNTMuNzZzLTUzLjc2LTI0LjE5Mi01My43Ni01My43NlY1NjUuNzZoLTE3MS40MzgwOGMtMjkuNTY4IDAtNTMuNzYtMjQuMTkyLTUzLjc2LTUzLjc2czI0LjE5Mi01My43NiA1My43Ni01My43Nkg0NjMuMzZ2LTE3MC45OTc3NmMwLTI5LjU2OCAyNC4xOTItNTMuNzYgNTMuNzYtNTMuNzZzNTMuNzYgMjQuMTkyIDUzLjc2IDUzLjc2VjQ1OC4yNGgxNzEuMzU4NzJjMjkuNTY4IDAgNTMuNzYgMjQuMTkyIDUzLjc2IDUzLjc2cy0yNC4xOTIgNTMuNzYtNTMuNzYgNTMuNzZ6IiBwLWlkPSI4MDYiIGZpbGw9IiM5RkEyQTgiPjwvcGF0aD48L3N2Zz4=\"\n                        alt=\"\"\n                    />\n                </div>\n            </div>\n        );\n    };\n\n    handleSelectAll = () => {\n        const { data, onSelect } = this.props;\n        this.setContext(\n            {\n                selectedData: data\n            },\n            () => {\n                if (onSelect) {\n                    onSelect(this.state.context.selectedData);\n                }\n            }\n        );\n    };\n\n    /**\n     * Check whether the drag node overlaps\n     * @param drawId\n     * @param pos\n     * @returns\n     */\n    validateIsOverlap = (drawId, pos): boolean => {\n        const {\n            data: { nodes },\n            overlap,\n            overlapOffset = {}\n        } = this.props;\n\n        if(!overlap) return false;\n\n        const getNodeOffsetPos = (position: IPosition, id: string): IPosition => {\n            return {\n                x: position.x + getNodeSize(id).width + overlapOffset.offsetX || 0,\n                y: position.y+ getNodeSize(id).height + overlapOffset.offsetY || 0,\n            }\n        }\n\n        const S1 = {\n            x: pos.x,\n            y: pos.y\n        }\n        const S2 = getNodeOffsetPos(pos, drawId);\n        const posMap: IPosMap[] = nodes && nodes.filter(n => n.id !== drawId && !n.filterOverlap).map(n => {\n            return {\n                T1: {\n                    x: n.position.x,\n                    y: n.position.y,\n                },\n                T2:  getNodeOffsetPos(n.position, n.id)\n            }\n        })\n        const isOverlap = posMap.some((p: IPosMap) => !(S2.y < p.T1.y || S1.y > p.T2.y || S2.x < p.T1.x || S1.x > p.T2.x) === true);\n        return isOverlap;\n    }\n\n    render() {\n        const { connectDropTarget, showBar } = this.props;\n        const { context, scaleNum } = this.state;\n        return connectDropTarget!(\n            <div className=\"byai-topology\">\n                <div\n                    ref={r => {\n                        this.$wrapper = r;\n                    }}\n                    className={classnames({\n                        \"topology-wrapper\": true,\n                        \"topology-linking\": context.linking\n                    })}\n                    onMouseDown={this.handleMouseDown}\n                    onMouseMove={this.handleMouseMove}\n                    onMouseUp={this.handleMouseUp}\n                    onMouseLeave={this.clearMouseEventData}\n                >\n                    <div\n                        ref={r => {\n                            this.$canvas = r;\n                        }}\n                        className=\"topology-canvas topology-zoom\"\n                        // @ts-ignore\n                        style={{\n                            width: config.canvas.width,\n                            height: config.canvas.height,\n                            // @ts-ignore\n                            \"--scaleNum\": scaleNum\n                        }}\n                        onClick={this.handleCanvasClick}\n                    >\n                        <Provider value={context}>\n                            {this.renderNodes()}\n                            {this.renderLines()}\n                        </Provider>\n                    </div>\n                </div>\n                {showBar !== false && this.renderToolBars()}\n            </div>\n        );\n    }\n}\n\nfunction hover(props: ITopologyProps, monitor, component: Topology) {\n    if (!monitor.getItem()) {\n        return;\n    }\n    const { context } = component.state;\n    const clientOffset = monitor.getClientOffset();\n    const { id, type } = monitor.getItem();\n    switch (type) {\n        case NodeTypes.ANCHOR:\n            if (clientOffset) {\n                const nodeId = id.split('-')[0];\n                const parentNode = props.data.nodes.find(item => item.id === nodeId);\n                const hasAnchorExistLine = !props.canConnectMultiLines && props.data.lines.find(item => item.start === id);\n                if (hasAnchorExistLine || !parentNode || !component.$wrapper) { return; }\n\n                const startPo = context.activeLine ? context.activeLine.start : computeAnchorPo(`dom-map-${id}`, parentNode);\n                const endPo = computeCanvasPo(\n                    clientOffset,\n                    component.$wrapper\n                );\n                if (!startPo || !endPo) {\n                     return;\n                }\n                const impactNode = component.impactCheck(endPo, startPo, id);\n                component.setContext({\n                    impactNode,\n                    linking: true,\n                    activeLine: {\n                        type: LineEditType.ADD,\n                        origin: null,\n                        start: startPo,\n                        end: endPo\n                    }\n                });\n            }\n            break;\n        default:\n            break;\n    }\n}\n\n\nexport default DropTarget(\n    [NodeTypes.NORMAL_NODE, NodeTypes.TEMPLATE_NODE, NodeTypes.ANCHOR],\n    {\n        canDrop(props: ITopologyProps) {\n            return !props.readOnly;\n        },\n        hover: _.throttle(hover, 40),\n        drop(props: ITopologyProps, monitor, component: Topology) {\n            if (monitor.didDrop() || !component.$wrapper) {\n                return;\n            }\n            const item = monitor.getItem();\n            const type = monitor.getItemType();\n            const clientOffset = monitor.getDifferenceFromInitialOffset();\n\n            if (!clientOffset) {\n                return;\n            }\n\n            const getNodePosition = (nodeDom, isChild?) => {\n                const nodePosition = {\n                    top: nodeDom.style.top,\n                    left: nodeDom.style.left\n                };\n                const scalePosition = {\n                    x:\n                        Number(nodePosition.left.replace(/[px]+/g, \"\")) +\n                        clientOffset.x / component.scaleNum,\n                    y:\n                        Number(nodePosition.top.replace(/[px]+/g, \"\")) +\n                        clientOffset.y / component.scaleNum\n                };\n\n                const scrollPosition = computeCanvasPo(\n                    monitor.getSourceClientOffset(),\n                    component.$wrapper\n                )\n                /**\n                 * TODO： scaleNum 缩放与窗口滚动时有冲突, isChild 为子节点联动时使用 scalePosition 定位\n                 */\n                 const position = component.scaleNum === 1 ? (\n                     isChild ? scalePosition : scrollPosition\n                 ) : scalePosition\n                return position;\n            }\n\n            /**\n             * Get the mapping relationship between the id and position of all child nodes of the current dragging node\n             * @returns\n             */\n            const getChildPosMap = () => {\n                const { lines, nodes } = props.data;\n                const curNode = nodes.find(n => n.id === item.id);\n                const dragChild = curNode.dragChild || isMatchKeyValue(curNode, 'dragChild', true);\n                if(!dragChild) return null;\n                const childIds = lines.filter(n => n.start.split('-')[0] === item.id).map(n => n.end);\n                let childPosMap = {};\n                for (let childId of childIds) {\n                    let childNodeDom: HTMLElement = document.getElementById(`topology-node-${childId}`);\n                    if(!childNodeDom) return null;\n                    childPosMap[childId] = getNodePosition(childNodeDom, true);\n                }\n                return childPosMap;\n            }\n\n            let position;\n            let nodeDom: HTMLElement = document.getElementById(`topology-node-${item.id}`);\n            if (nodeDom) {\n                position = getNodePosition(nodeDom);\n            } else {\n                position = computeCanvasPo(\n                    monitor.getSourceClientOffset(),\n                    component.$wrapper\n                )\n            }\n\n            const isOverlap = (id, position) => {\n                return component.validateIsOverlap(id, position);\n            }\n\n            switch (type) {\n                case NodeTypes.TEMPLATE_NODE:\n                    if (!item.data) {\n                        return;\n                    }\n                    /**\n                     * TODO：Here first render the newly added node, if it overlaps, delete the node\n                     * The main reason is that there is currently no good unified method to get the default width and height of the newly added nodes in the upper layer.\n                     */\n                    component.onChange({\n                        ...props.data,\n                        nodes: [...props.data.nodes, { ...item.data, position }],\n                    }, ChangeType.ADD_NODE);\n\n                    if(isOverlap(item.data.id, position)) {\n                         component.onChange({\n                            ...props.data,\n                            nodes: [...props.data.nodes],\n                        }, ChangeType.ADD_NODE);\n                        props.overlapCallback && props.overlapCallback();\n                    };\n                    break;\n                case NodeTypes.NORMAL_NODE:\n                    if(isOverlap((item as ITopologyNode).id, position)) {\n                        props.overlapCallback && props.overlapCallback();\n                        return;\n                    };\n                    component.handleNodeDraw((item as ITopologyNode).id, position, getChildPosMap());\n                    break;\n                case NodeTypes.ANCHOR:\n                    component.handleLineDraw((item as { id: string }).id);\n                    break;\n                default:\n                    break;\n            }\n        },\n    },\n    connect => ({ connectDropTarget: connect.dropTarget() }),\n)(Topology);\n"]}]}